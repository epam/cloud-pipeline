(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{2614:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return Ke}});var r=n(7462),i=n(7294),o=n(3935),a=n(4942),c=n(9439),s=n(5697),u=n.n(s),l=n(3238),f="set-data",d="set-source-initializing",p="set-source",v="set-source-error",m="set-image",b="set-image-viewport-loaded";function h(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function y(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?h(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):h(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function g(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function O(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?g(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):g(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function w(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function j(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?w(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):w(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var P=function(e,t){switch(t.type){case f:return function(e,t){var n=t.url,r=t.offsetsUrl,i=t.callback,o=e.url,a=e.offsetsUrl;return o===n&&r===a?(i&&i(),e):y(y({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,imageTimePosition:0,imageZPosition:0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:i,error:void 0,url:n,offsetsUrl:r})}(e,t);case"set-error":return function(e,t){var n=t.error;return O(O({},e),{},{error:n})}(e,t);case d:return function(e){return j(j({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0,imagePending:!1})}(e);case v:return function(e,t){var n=t.error,r=e.sourceCallback;return"function"==typeof r&&setTimeout((function(){r({error:n})}),0),j(j({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:n,sourcePending:!1,sourceCallback:void 0})}(e,t);case p:return function(e,t){var n=t.source,r=e.sourceCallback;"function"==typeof r&&setTimeout((function(){r()}),0);var i=Array.isArray(n)?n:[n],o=i.map((function(e){return e.data})),a=i.map((function(e){return e.metadata}));return j(j({},e),{},{loader:o,metadata:a,imageIndex:0,source:n,sourceError:void 0,sourcePending:!1,sourceCallback:void 0})}(e,t);case m:return function(e,t){var n,r=t.index,i=t.ID,o=t.Name,a=t.search,s=t.imageTimePosition,u=void 0===s?0:s,l=t.imageZPosition,f=void 0===l?0:l,d=e.metadata,p=void 0===d?[]:d;if(null!=r)n=p[r];else if(void 0!==i)n=p.find((function(e){return e.ID===i}));else if(void 0!==o)n=p.find((function(e){return(e.Name||e.name||"").toLowerCase()===o.toLowerCase()}));else if(a&&/^[\d]+_[\d]+$/.test(a)){var v=/^([\d]+)_([\d])+$/.exec(a),m=(0,c.Z)(v,3),b=m[1],h=m[2],y=new RegExp("^\\s*well\\s+".concat(b,"\\s*,\\s*field\\s+").concat(h,"\\s*$"),"i");n=p.find((function(e){return y.test(e.Name||e.name)}))}if(n){var g=p.indexOf(n);return j(j({},e),{},{imageIndex:g,imagePending:!0,imageTimePosition:u,imageZPosition:f})}return e}(e,t);case b:return function(e){return j(j({},e),{},{imagePending:!1})}(e);default:return e}},x=n(5861),Z=n(3144),S=n(5671),k=n(136),D=n(4575),C=n(1120),E=n(2407),L=n(7757),z=n.n(L),M=n(265);var I=function(e){(0,k.Z)(i,e);var t,n,r=(t=i,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,C.Z)(t);if(n){var i=(0,C.Z)(this).constructor;e=Reflect.construct(r,arguments,i)}else e=r.apply(this,arguments);return(0,D.Z)(this,e)});function i(e){var t;return(0,S.Z)(this,i),t=e?r.call(this,"offsets.json file not found: ".concat(e)):r.call(this,"offsets.json file not specified"),(0,D.Z)(t)}return(0,Z.Z)(i)}((0,E.Z)(Error));function A(e,t,n){return R.apply(this,arguments)}function R(){return(R=(0,x.Z)(z().mark((function e(t,n,r){var i,o,a,c,s,u,l,f,d;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,M.W0)(t);case 2:return o=e.sent,e.next=5,o.getImage(0);case 5:if(a=e.sent,!Boolean(null==a||null===(i=a.fileDirectory)||void 0===i?void 0:i.SubIFDs)){e.next=9;break}return e.abrupt("return",n.reduce((function(e,t){var n=t.Pixels;return n.SizeC*n.SizeT*n.SizeZ+e}),1));case 9:return c=r[0].length,s=n[0].Pixels,u=s.SizeC,l=s.SizeT,f=s.SizeZ,d=u*l*f,e.abrupt("return",d*c);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function V(){return V=(0,x.Z)(z().mark((function e(){var t,n,r,i,o,a,c,s=arguments;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.url,!(r=t.offsetsUrl)){e.next=8;break}return e.next=5,fetch(r);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=void 0;case 9:if(i=e.t0,o=!i||!i.ok){e.next=17;break}return e.next=14,i.json();case 14:e.t1=e.sent,e.next=18;break;case 17:e.t1=void 0;case 18:return a=e.t1,e.next=21,(0,l.$L)(n,{offsets:a,images:"all"});case 21:if(c=e.sent,!o){e.next=28;break}return e.next=25,A(n,c.map((function(e){return e.metadata})),c.map((function(e){return e.data})));case 25:if(!(e.sent>40)){e.next=28;break}throw new I(r);case 28:return e.abrupt("return",c);case 29:case"end":return e.stop()}}),e)}))),V.apply(this,arguments)}var B="set-default",T="set-loading",N="set-loaded",U="set-error",F="set-channel-properties",G="set-color-map",$="set-lens-channel",H="set-lens-enabled",W="set-global-position",_="set-lock-channels";function q(){var e=[];return{identifiers:[],channels:[],channelsVisibility:[],selections:e,builtForSelections:e,globalSelection:void 0,colors:[],domains:[],realDomains:[],contrastLimits:[],useLens:!1,useColorMap:!1,colorMap:"",lensEnabled:!1,lensChannel:0,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1,isRGB:!1,shapeIsInterleaved:!1,pending:!1,globalDimensions:[],metadata:void 0,loader:[],error:void 0,lockChannels:!1}}var J=n(3433),K=n(4506);function Q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var X=n(4925),Y=["channels","colors","domains","contrastLimits"];function ee(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ee(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ee(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ne=[],re=n(4477);function ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function oe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ie(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ae=[],ce=[0,1];function se(e,t){switch(t.type){case T:return oe(oe({},e),{},{pending:!0,error:void 0});case N:return oe(oe({},e),{},{pending:!1});case F:return function(e,t,n){var r=Object.entries(n||{}).filter((function(t){var n=(0,c.Z)(t,1)[0];return e&&e[n]&&Array.isArray(e[n])}));if(r.length>0){var i=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Q(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e||{});return r.forEach((function(e){var n=(0,c.Z)(e,2),r=n[0],o=n[1],a=i[r];i[r]=(0,J.Z)(a),i[r][t]=o})),i}return e}(e,t.channel,t.properties);case G:var n=t.colorMap,r=void 0===n?"":n;return e.useColorMap?oe(oe({},e),{},{colorMap:r}):e;case $:var i=t.lensChannel,o=void 0===i?0:i,s=e.lensEnabled,u=e.useLens;return s&&u?oe(oe({},e),{},{lensChannel:o}):e;case H:var l=t.lensEnabled,f=void 0!==l&&l,d=e.lensEnabled,p=e.useLens;return oe(oe({},e),{},p&&!d&&f?{lensEnabled:f,lensChannel:0}:{lensEnabled:!1});case W:var v=t.position,m=void 0===v?{}:v,b=e.globalDimensions,h=void 0===b?[]:b,y=e.selections,g=void 0===y?[]:y,O=e.globalSelection,w=void 0===O?{}:O,j=function(e,t){var n=(h.find((function(t){return t.label===e}))||{}).size,r=void 0===n?0:n;return Math.max(0,Math.min(r,Math.round(t)))},P=Object.entries(m).filter((function(e){var t=(0,c.Z)(e,1)[0];return re.Z.includes(t)&&h.find((function(e){return e.label===t}))})).map((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];return{dimension:n,position:j(n,r)}}));if(P.length>0){var x=P.map((function(e){var t=e.dimension,n=e.position;return(0,a.Z)({},t,n)})).reduce((function(e,t){return oe(oe({},e),t)}),{}),Z=oe(oe({},w),x),S=g.map((function(e){return oe(oe({},e),x)}));return oe(oe({},e),{},{selections:S,globalSelection:Z})}return e;case _:var k=t.lock,D=e.contrastLimits,C=void 0===D?ae:D,E=e.realDomains,L=void 0===E?ae:E,z=oe(oe({},e),{},{lockChannels:k});return k||(z.domains=L.slice(),z.contrastLimits=C.map((function(e,t){var n=L[t];if(n&&Array.isArray(n)&&2===n.length){var r=(0,K.Z)(e),i=r[0],o=r[1],a=r.slice(2),s=(0,c.Z)(n,2),u=s[0],l=s[1],f=function(e){return Math.max(u,Math.min(l,e))};return[f(i),f(o)].concat((0,J.Z)(a))}return e}))),z;case B:var M=function(e,t){var n=e||{},r=n.lockChannels,i=void 0!==r&&r,o=n.channels,a=void 0===o?ne:o,c=n.colors,s=void 0===c?ne:c,u=n.domains,l=void 0===u?ne:u,f=n.contrastLimits,d=void 0===f?ne:f,p=n.channelsVisibility,v=void 0===p?ne:p,m=t||{},b=m.channels,h=void 0===b?ne:b,y=m.colors,g=void 0===y?ne:y,O=m.domains,w=void 0===O?ne:O,j=m.contrastLimits,P=void 0===j?ne:j,x=(0,X.Z)(m,Y);if(!i)return te(te({},x),{},{channels:h,colors:g,domains:w,contrastLimits:P,realDomains:w.slice(),channelsVisibility:h.map((function(){return!0}))});for(var Z=a.slice(),S=[],k=0;k<h.length;k+=1){var D=Z.indexOf(h[k]);-1===D?S.push({channel:h[k],color:g[k],domain:w[k],realDomain:w[k].slice(),contrastLimits:P[k],visibility:!0}):(Z.splice(D,1,void 0),S.push({channel:h[k],color:s[D]||g[k],domain:l[D]||w[k],realDomain:w[k].slice(),contrastLimits:d[D]||P[k],visibility:void 0===v[D]||v[D]}))}return te(te({},x),{},{channels:S.map((function(e){return e.channel})),colors:S.map((function(e){return e.color})),domains:S.map((function(e){return e.domain})),realDomains:S.map((function(e){return e.realDomain})),contrastLimits:S.map((function(e){return e.contrastLimits})),channelsVisibility:S.map((function(e){return e.visibility}))})}(e,t),I=M.channels,A=void 0===I?ae:I,R=M.channelsVisibility,V=void 0===R?ae:R,q=M.selections,ee=void 0===q?ae:q,ie=M.colors,se=void 0===ie?ae:ie,ue=M.domains,le=void 0===ue?ae:ue,fe=M.realDomains,de=void 0===fe?le.slice():fe,pe=M.contrastLimits,ve=void 0===pe?ae:pe,me=M.useLens,be=void 0!==me&&me,he=M.useColorMap,ye=void 0!==he&&he,ge=M.colorMap,Oe=void 0===ge?ye?e.colorMap:"":ge,we=M.lensEnabled,je=void 0!==we&&we,Pe=M.lensChannel,xe=void 0===Pe?0:Pe,Ze=M.xSlice,Se=void 0===Ze?ce:Ze,ke=M.ySlice,De=void 0===ke?ce:ke,Ce=M.zSlice,Ee=void 0===Ce?ce:Ce,Le=M.use3D,ze=void 0!==Le&&Le,Me=M.ready,Ie=void 0!==Me&&Me,Ae=M.isRGB,Re=void 0!==Ae&&Ae,Ve=M.shapeIsInterleaved,Be=void 0!==Ve&&Ve,Te=M.globalDimensions,Ne=void 0===Te?ae:Te,Ue=M.metadata,Fe=M.loader;return oe(oe({},e),{},{identifiers:A.map((function(e,t){return"".concat(e||"channel","-").concat(t)})),channels:A,channelsVisibility:V,selections:ee,builtForSelections:ee,globalSelection:(ee||[])[0],pixelValues:new Array((ee||[]).length).fill("-----"),colors:se,domains:le,realDomains:de,contrastLimits:ve,useLens:be,useColorMap:ye,colorMap:Oe,lensEnabled:je,lensChannel:xe,xSlice:Se,ySlice:De,zSlice:Ee,use3D:ze,ready:Ie,isRGB:Re,shapeIsInterleaved:Be,globalDimensions:Ne,error:void 0,metadata:Ue,loader:Fe});case U:var Ge=t.error;return oe(oe({},e),{},{error:Ge,pending:!1});default:return e}}var ue=n(3467);function le(e){var t=e[e.length-1];return 3===t||4===t}function fe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function de(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?fe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function pe(e,t){for(var n=[],r=de(de({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:re.Z;return e.labels.filter((function(e){return t.includes(e)})).map((function(e){return(0,a.Z)({},e,0)})).reduce((function(e,t){return de(de({},e),t)}),{})}(e)),t||{}),i=e.labels.map((function(t,n){return{name:t,size:e.shape[n]}})).find((function(e){return!re.Z.includes(e.name)&&e.size})),o=0;o<Math.min(4,i.size);o+=1)n.push(de((0,a.Z)({},i.name,o),r));return le(e.shape)?[de(de({},n[0]),{},{c:0})]:n}function ve(e){return me.apply(this,arguments)}function me(){return(me=(0,x.Z)(z().mark((function e(t){var n,r,i,o,a,c,s;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,i=Array.isArray(n)?n[n.length-1]:n,e.next=4,i.getRaster({selection:r});case 4:return o=e.sent,a=(0,l.mx)(o.data),c=a.domain,s=a.contrastLimits,e.abrupt("return",{domain:c,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function be(e){return he.apply(this,arguments)}function he(){return(he=(0,x.Z)(z().mark((function e(t){var n,r,i,o,a,c,s,u,f,d,p,v;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,i=n[n.length-1],o=i.shape,a=i.labels,c=o[a.indexOf("z")]>>n.length-1,e.next=6,i.getRaster({selection:de(de({},r),{},{z:0})});case 6:return s=e.sent,e.next=9,i.getRaster({selection:de(de({},r),{},{z:Math.floor(c/2)})});case 9:return u=e.sent,e.next=12,i.getRaster({selection:de(de({},r),{},{z:Math.max(0,c-1)})});case 12:return f=e.sent,d=(0,l.mx)(s.data),p=(0,l.mx)(u.data),v=(0,l.mx)(f.data),e.abrupt("return",{domain:[Math.min(d.domain[0],p.domain[0],v.domain[0]),Math.max(d.domain[1],p.domain[1],v.domain[1])],contrastLimits:[Math.min(d.contrastLimits[0],p.contrastLimits[0],v.contrastLimits[0]),Math.max(d.contrastLimits[1],p.contrastLimits[1],v.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ye(e){return ge.apply(this,arguments)}function ge(){return(ge=(0,x.Z)(z().mark((function e(t){var n,r,i,o;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,i=t.use3d,o=i?be:ve,e.abrupt("return",o({loader:n,selection:r}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Oe(e){return we.apply(this,arguments)}function we(){return(we=(0,x.Z)(z().mark((function e(t){var n,r,i,o,a,c;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selections,i=t.use3d,e.next=3,Promise.all(r.map((function(e){return ye({loader:n,selection:e,use3d:i})})));case 3:return o=e.sent,a=o.map((function(e){return e.domain})),c=o.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:a,contrastLimits:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function je(e){var t=Array.isArray(e)?e[0]:e,n=t.shape,r=t.labels,i=function(e){var t,n,r=null!==(t=null==e||null===(n=e.meta)||void 0===n?void 0:n.physicalSizes)&&void 0!==t?t:{},i=r.x,o=r.y,a=r.z;if(null!=i&&i.size&&null!=o&&o.size&&null!=a&&a.size){var c=Math.min(a.size,i.size,o.size),s=[i.size/c,o.size/c,a.size/c];return(new ue.Z).scale(s)}return(new ue.Z).identity()}(t);return[[0,i[0]*n[r.indexOf("x")]],[0,i[5]*n[r.indexOf("y")]],[0,i[10]*n[r.indexOf("z")]]]}function Pe(e){var t=e.Pixels||{},n=t.Channels,r=void 0===n?[]:n,i=t.SizeC,o=void 0===i?0:i,a=t.Interleaved,c=void 0!==a&&a,s=t.Type,u=r.length,l=(r[0]||{}).SamplesPerPixel;return 3===(void 0===l?0:l)||3===u&&"uint8"===s||3===o&&1===u&&c}var xe=[255,0,0],Ze=[0,255,0],Se=[0,0,255],ke=[255,255,255],De=[Se,Ze,[255,0,255],[255,255,0],[255,60,0],[154,0,255],ke,xe],Ce=[0,255];function Ee(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}function Le(e,t,n,r){return ze.apply(this,arguments)}function ze(){return(ze=(0,x.Z)(z().mark((function e(t,n,r,i){var o,a,s,u,l,f,d,p,v,m,b,h,y,g,O,w,j,P,x,Z,S,k;return z().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(o=t[0]||{},a=o.shape,s=o.labels,u=(void 0===s?[]:s).map((function(e,t){return{label:e,size:a[t]||0}})).filter((function(e){return e.size>1&&re.Z.includes(e.label)})),l=r||pe(t[0],i),f=n.Pixels,d=(void 0===f?{}:f).Channels,p=void 0===d?[]:d,v=[],m=[],b=[],h=!1,y=!1,g=Pe(n),O=g&&le(a),!g){e.next=18;break}le(a)?(v=[Ce.slice()],b=[Ce.slice()],m=[xe]):(v=[Ce.slice(),Ce.slice(),Ce.slice()],b=[Ce.slice(),Ce.slice(),Ce.slice()],m=[xe,Ze,Se]),h=!1,y=!1,e.next=26;break;case 18:return e.next=20,Oe({loader:t,selections:l,use3d:!1});case 20:w=e.sent,b=w.domains.slice(),v=w.contrastLimits.slice(),m=1===w.domains.length?[ke]:w.domains.map((function(e,t){return De[t]})),h=p.length>1,y=!0;case 26:return j=p.map(Ee),P=je(t),x=(0,c.Z)(P,3),Z=x[0],S=x[1],k=x[2],e.abrupt("return",{channels:j,selections:l,useLens:h,useColorMap:y,colors:m,domains:b,contrastLimits:v,xSlice:Z,ySlice:S,zSlice:k,ready:!0,isRGB:g,shapeIsInterleaved:O,globalDimensions:u,metadata:n,loader:t});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Me(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Me(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ae(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},o=r.selections,a=r.cache,c=r.imageTimePosition,s=void 0===c?0:c,u=r.imageZPosition,l=void 0===u?0:u,f=(0,i.useRef)(0);(0,i.useEffect)((function(){var r=e&&t&&e.Pixels&&t.length;if(r&&(o&&o!==a||!o)){n({type:T}),f.current+=1;var i=f.current;Le(t,e,o,s||l?{t:s,z:l}:void 0).then((function(e){i===f.current&&n(Ie({type:B},e))})).catch((function(e){console.warn("HCS Image Viewer error: ".concat(e.message)),console.error(e),n({type:U,error:e.message})}))}else r||n({type:B})}),[e,t,s,l,o,a,f,n])}var Re={url:void 0,offsetsUrl:void 0,source:void 0,sourcePending:!1,sourceError:void 0,sourceCallback:void 0,loader:void 0,metadata:void 0,imageIndex:0,imagePending:!1,imageTimePosition:0,imageZPosition:0,error:void 0,pending:!1},Ve=i.createContext(Re);function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ne(){return{}}function Ue(){var e=(0,i.useReducer)(P,{},Ne),t=(0,c.Z)(e,2),n=t[0],r=t[1];!function(e,t){var n=e||{},r=n.url,o=n.offsetsUrl,a=n.source;(0,i.useEffect)((function(){r&&(t({type:d}),function(){return V.apply(this,arguments)}({url:r,offsetsUrl:o}).then((function(e){return t({type:p,source:e})})).catch((function(e){return t({type:v,error:e.message})})))}),[r,o,t])}(n,r);var o=function(e){var t=(0,i.useReducer)(se,{},q),n=(0,c.Z)(t,2),r=n[0],o=n[1],a=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.metadata,i=void 0===r?[]:r;if(!(n<0||n>=i.length))return i[n]}(e),s=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.loader,i=void 0===r?[]:r;if(!(n<0||n>=i.length))return i[n]}(e),u=e.imageTimePosition,l=void 0===u?0:u,f=e.imageZPosition,d=void 0===f?0:f,p=r.metadata,v=r.loader,m=r.selections,b=r.builtForSelections;return Ae(a,s,o,(0,i.useMemo)((function(){return{imageTimePosition:l,imageZPosition:d}}),[l,d])),Ae(p,v,o,(0,i.useMemo)((function(){return{selections:m,cache:b}}),[m,b])),{state:r,dispatch:o}}(n),a=o.state,s=o.dispatch,u=(0,i.useCallback)((function(e,t,n){r({url:e,offsetsUrl:t,callback:n,type:f})}),[r]),l=(0,i.useCallback)((function(e){r(Te({type:m},e))}),[r]),h=(0,i.useCallback)((function(e){r(Te({type:b},e)),s({type:N})}),[r,s]),y=(0,i.useCallback)((function(){s({type:T})}),[s]),g=(0,i.useCallback)((function(e,t){s({type:F,channel:e,properties:t})}),[s]),O=(0,i.useCallback)((function(e){s({type:G,colorMap:e})}),[s]),w=(0,i.useCallback)((function(e){s({type:H,lensEnabled:e})}),[s]),j=(0,i.useCallback)((function(e){s({type:$,lensChannel:e})}),[s]),x=(0,i.useCallback)((function(e){s({type:W,position:e})}),[s]),Z=(0,i.useCallback)((function(e){s({type:_,lock:e})}),[s]);return{callbacks:(0,i.useMemo)((function(){return{setData:u,setImage:l,setImageViewportLoading:y,setImageViewportLoaded:h,setChannelProperties:g,setColorMap:O,setLensEnabled:w,setLensChannel:j,setGlobalPosition:x,setLockChannels:Z}}),[u,l,y,h,g,O,w,j,x,Z]),dispatch:r,state:n,viewerState:a,viewerDispatch:s}}function Fe(e){if(e&&e.shape){var t=le(e.shape),n=e.shape.slice(t?-3:-2),r=(0,c.Z)(n,2);return{height:r[0],width:r[1]}}}function Ge(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Array.isArray(e)?e[0]:e,i=Fe(r);if(i&&t){var o=i.width,a=i.height;return Math.log2(Math.min(t.width/o,t.height/a))-n}return-1/0}function $e(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function He(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$e(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$e(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var We=new l.$h,_e=new l.z6;function qe(e){var t=e.className,n=e.onStateChange,r=e.onRegisterStateActions,o=e.onViewerStateChanged,a=e.style,s=e.minZoomBackOff,u=void 0===s?0:s,f=e.maxZoomBackOff,d=void 0===f?void 0:f,p=e.defaultZoomBackOff,v=void 0===p?0:p,m=e.overview,b=Ue(),h=b.state,y=b.viewerState,g=b.callbacks,O=(0,i.useRef)(),w=function(e){var t=(0,i.useState)({width:void 0,height:void 0}),n=(0,c.Z)(t,2),r=n[0],o=n[1];return(0,i.useEffect)((function(){var t,n,r;return function i(){var a,c,s=null==e||null===(a=e.current)||void 0===a?void 0:a.clientWidth,u=null==e||null===(c=e.current)||void 0===c?void 0:c.clientHeight;e&&e.current&&(s!==t||u!==n)&&o({width:t=s,height:n=u}),r=requestAnimationFrame(i)}(),function(){return cancelAnimationFrame(r)}}),[e,o]),r}(O);(0,i.useEffect)((function(){n&&n(h)}),[h,n]),(0,i.useEffect)((function(){o&&o(y)}),[y,o]),(0,i.useEffect)((function(){r&&r(g)}),[g,r]);var j=g||{},P=j.setImageViewportLoading,x=j.setImageViewportLoaded,Z=y.channelsVisibility,S=void 0===Z?[]:Z,k=y.contrastLimits,D=void 0===k?[]:k,C=y.colors,E=void 0===C?[]:C,L=y.selections,z=void 0===L?[]:L,M=y.ready,I=void 0!==M&&M,A=y.colorMap,R=y.loader,V=y.useLens,B=y.lensEnabled,T=y.lensChannel;(0,i.useEffect)((function(){"function"==typeof P&&P()}),[z,R,P]);var N=(0,i.useState)(void 0),U=(0,c.Z)(N,2),F=U[0],G=U[1];(0,i.useEffect)((function(){if(R&&R.length&&w&&w.width&&w.height){var e=Array.isArray(R)?R:[R],t=(0,c.Z)(e,1)[0],n=Array.isArray(R)?R[R.length-1]:R,r=[He(He({},(0,l.TI)(R,w,v)),{},{id:l.ys,minZoom:void 0!==u?Ge(t,w,u):-1/0,maxZoom:void 0!==d?Ge(n,w,d):1/0})];G(r)}else G(void 0)}),[R,w,G,u,d,v]);var $=R&&I&&w&&w.width&&w.height&&F;return i.createElement(Ve.Provider,{value:h},i.createElement("div",{className:t,style:He({position:"relative"},a||{}),ref:O},$&&i.createElement(l.J9,{contrastLimits:D,colors:E,channelsVisible:S,loader:R,selections:z,height:w.height,width:w.width,extensions:A?[We]:[_e],colormap:A||"viridis",onViewportLoad:x,viewStates:F,overviewOn:!!m,overview:m,lensSelection:V&&B?T:void 0,lensEnabled:V&&B})))}qe.propTypes={className:u().string,onStateChange:u().func,onRegisterStateActions:u().func,onViewerStateChanged:u().func,style:u().object,minZoomBackOff:u().number,maxZoomBackOff:u().number,defaultZoomBackOff:u().number,overview:u().object},qe.defaultProps={className:void 0,onStateChange:void 0,onRegisterStateActions:void 0,onViewerStateChanged:void 0,style:void 0,minZoomBackOff:0,maxZoomBackOff:void 0,defaultZoomBackOff:0,overview:void 0};var Je=qe;function Ke(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.onStateChange,c=n.onRegisterStateActions,s=n.onViewerStateChanged;o.render(i.createElement(Je,(0,r.Z)({onRegisterStateActions:c,onStateChange:a,onViewerStateChanged:s},t)),e)}},802:function(){},2195:function(){},1998:function(){},9521:function(){},9214:function(){},3752:function(){},3640:function(){},2630:function(){}}]);