version: 0.17.{build}

branches:
  only:
    - develop
    - /release\/.*/
    - /stage\/.*/
    - test_mac_pipecli_build

skip_tags: true
max_jobs: 1
# stack: node 14, jdk 8
matrix:
  fast_finish: true

environment:
  matrix:
    - job_name: CLI_MacOS
      appveyor_build_worker_image: macos-catalina
      appveyor_build_worker_cloud: ip-172-31-13-99.eu-central-1.compute.internal
    - job_name: Publish_Docs
      appveyor_build_worker_image: Ubuntu1604
    - job_name: Build_All
      job_depends_on: CLI_MacOS
      appveyor_build_worker_image: Ubuntu1604
      

for:

  -
    matrix:
      only:
        - job_name: CLI_MacOS

    build_script:
    - |-
      echo "-----------------------------------------------"
      echo "MacOS Hardware information"
      system_profiler SPHardwareDataType
      arch
      sw_vers
      hostname
      echo "End info"
      echo "-----------------------------------------------"
  
  -
    matrix:
      only:
        - job_name: Build_All

    build_script:
    - |-
      sudo ln -s "$NVM_DIR/versions/node/$(nvm version)/bin/node" "/usr/local/bin/node"
      sudo ln -s "$NVM_DIR/versions/node/$(nvm version)/bin/npm" "/usr/local/bin/npm"
      sudo -E bash deploy/appveyor/appveyor_pack_dist.sh

  -
    matrix:
      only:
        - job_name: Publish_Docs

    build_script:
    - |-
      sudo pip install mkdocs
      sudo -E bash deploy/appveyor/appveyor_publish_docs.sh
test: off
