<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
    <meta charset="utf-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <link rel="shortcut icon" href="../../../../img/favicon.ico" />
    <title>Terraform - Cloud Pipeline</title>
    <link rel="stylesheet" href="../../../../css/theme.css" />
    <link rel="stylesheet" href="../../../../css/theme_extra.css" />
        <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/styles/github.min.css" />
        <link href="../../../../css/extra.css" rel="stylesheet" />
    
      <script>
        // Current page data
        var mkdocs_page_name = "Terraform";
        var mkdocs_page_input_path = "installation/deployment/aws/terraform/README.md";
        var mkdocs_page_url = null;
      </script>
    
    <script src="../../../../js/jquery-3.6.0.min.js" defer></script>
    <!--[if lt IE 9]>
      <script src="../../../../js/html5shiv.min.js"></script>
    <![endif]-->
      <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/10.5.0/highlight.min.js"></script>
      <script>hljs.initHighlightingOnLoad();</script> 
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
    <div class="wy-side-scroll">
      <div class="wy-side-nav-search">
          <a href="../../../.." class="icon icon-home"> Cloud Pipeline
        </a><div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../../search.html" method="get">
      <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
                <li class="toctree-l1"><a class="reference internal" href="../../../..">Introduction</a>
                </li>
              </ul>
              <p class="caption"><span class="caption-text">Release notes</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../release_notes/v.0.13/v.0.13_-_Release_notes/">v.0.13</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../release_notes/v.0.14/v.0.14_-_Release_notes/">v.0.14</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../release_notes/v.0.15/v.0.15_-_Release_notes/">v.0.15</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../release_notes/v.0.16/v.0.16_-_Release_notes/">v.0.16</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../release_notes/v.0.17/v.0.17_-_Release_notes/">v.0.17</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">User guide</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Cloud_Pipeline_-_Manual/">Contents</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/01_Quick_start/1._Quick_start/">1. Quick start</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/02_Getting_started/2._Getting_started/">2. Getting started</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/03_Overview/3._Overview/">3. Overview</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">4. Manage Folder</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4._Manage_Folder/">4.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4.1._Create_an_object_in_Folder/">4.1. Create an object in Folder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4.2._Rename_folder/">4.2. Rename Folder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4.3._Delete_Folder/">4.3. Delete Folder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4.4._Clone_a_folder/">4.4. Clone a Folder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/04_Manage_Folder/4.5._Lock_a_folder/">4.5. Lock a Folder</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">5. Manage Metadata</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5._Manage_Metadata/">5.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5.1._Add_Delete_metadata_items/">5.1. Add/delete Metadata items</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5.2._Upload_metadata/">5.2. Upload Metadata</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5.3._Customize_view_of_the_entity_instance_table/">5.3. Customize view of the entity instance table</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5.4._Launch_a_run_configuration_on_metadata/">5.4. Launch a Run configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/05_Manage_Metadata/5.5._Download_data_from_external_resources_to_the_cloud_data_storage/">5.5. Download data from external resources</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">6. Manage Pipeline</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6._Manage_Pipeline/">6.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6.1._Create_and_configure_pipeline/">6.1. Create and configure Pipeline</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6.1.1._Building_WDL_pipeline_with_graphical_PipelineBuilder/">6.1.1. Building WDL Pipeline with graphical PipelineBuilder</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6.2._Launch_a_pipeline/">6.2. Launch a Pipeline</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6.3._Delete_a_pipeline/">6.3. Delete and unregister Pipeline</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/06_Manage_Pipeline/6.4._Work_with_aws_healthomics_workflow/">6.4. Work with AWS HealthOmics Workflow</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">7. Manage Detached configuration</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/07_Manage_Detached_configuration/7._Manage_Detached_configuration/">7.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/07_Manage_Detached_configuration/7.1._Create_and_customize_Detached_configuration/">7.1. Create and customize Detached configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/07_Manage_Detached_configuration/7.2._Launch_Detached_Configuration/">7.2. Launch Detached configuration</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/07_Manage_Detached_configuration/7.3._Expansion_Expressions/">7.3. Expansion expressions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/07_Manage_Detached_configuration/7.4._Remove_Detached_configuration/">7.4. Remove Detached configuration</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">8. Manage Data Storage</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8._Manage_Data_Storage/">8.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.1._Create_and_edit_storage/">8.1. Create and edit Data Storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.2._Upload_Download_data/">8.2. Upload/Download data</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.3._Create_and_Edit_text_files/">8.3. Create and edit text files</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.4._Control_File_versions/">8.4. Control file versions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.5._Delete_and_unregister_Data_Storage/">8.5. Delete and unregister Data Storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.6._Delete_Files_and_Folders_from_Storage/">8.6. Delete Files and Folders from Data Storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.7._Create_shared_file_system/">8.7. Create shared file system</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.8._Data_sharing/">8.8. Data sharing</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.9._Mapping_storages/">8.9. Mapping storages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.10._Storage_lifecycle/">8.10. Storage lifecycle</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.11._Sensitive_storages/">8.11. Sensitive storages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.12._Cloud_Data_app/">8.12. Cloud Data application</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.13._Versioned_storages/">8.13. Versioned storages</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/08_Manage_Data_Storage/8.14._Omics_storages/">8.14. Omics storages</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">9. Manage cluster nodes</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/09_Manage_Cluster_nodes/9._Manage_Cluster_nodes/">9.0. Cluster nodes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/09_Manage_Cluster_nodes/9.1._Hot_node_pools/">9.1. Hot node pools</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">10. Manage Tools</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10._Manage_Tools/">10.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.1._Add_Edit_a_Docker_registry/">10.1. Add and edit a Docker registry</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.2._Add_Edit_a_Tool_group/">10.2. Add/edit a Tool group</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.3._Add_a_Tool/">10.3. Add a Tool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.4._Edit_a_Tool/">10.4. Edit a Tool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.5._Launch_a_Tool/">10.5. Launch a Tool</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.6._Tool_security_check/">10.6. Tool security check</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.7._Tool_version_menu/">10.7. Tool version menu</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.8._Symlinks_between_tools/">10.8. "Symlinked" tools</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/10_Manage_Tools/10.9._Run_capabilities/">10.9. Run capabilities</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">11. Manage Runs</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/11_Manage_Runs/11._Manage_Runs/">11.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/11_Manage_Runs/11.1._Manage_runs_lifecycles/">11.1. Manage runs lifecycles</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/11_Manage_Runs/11.2._Auto-commit_Docker_image/">11.2. Auto-commit Docker images</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/11_Manage_Runs/11.3._Sharing_with_other_users_or_groups_of_users/">11.3. Sharing with other users</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/11_Manage_Runs/11.4._Automatic_actions_after_notifications/">11.4. Automatic labels and actions for the runs</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">12. Manage settings</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12._Manage_Settings/">12.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.1._Add_a_new_system_event/">12.1. Add a new system event</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.2._Edit_a_system_event/">12.2. Edit a system event</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.3._Create_a_new_user/">12.3. Create a new user</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.4._Edit_delete_a_user/">12.4. Edit/delete a user</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.5._Create_a_group/">12.5. Create a group</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.6._Edit_a_group_role/">12.6. Edit a group/role</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.7._Delete_a_group/">12.7. Delete a group</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.8._Change_a_set_of_roles_groups_for_a_user/">12.8. Change a set of roles/groups for a user</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.9._Change_email_notification/">12.9. Email notifications</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.10._Manage_system-level_settings/">12.10. Manage system-level settings</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.11._Advanced_features/">12.11. Advanced features</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.12._System_logs/">12.12. System logs</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.13._System_dictionaries/">12.13. System dictionaries</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.14._NAT_gateway/">12.14. NAT gateway</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/12_Manage_Settings/12.15._System_jobs/">12.15. System jobs</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/13_Permissions/13._Permissions/">13. Permissions</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">14. CLI interface</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14._Command-line_interface/">14.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.1._Install_and_setup_CLI/">14.1. Install and setup</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.2._View_and_manage_Attributes_via_CLI/">14.2. View and manage Attributes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.3._Manage_Storage_via_CLI/">14.3. Manage Data Storage</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.4._View_pipeline_definitions_via_CLI/">14.4. View pipeline definitions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.5._Manage_pipeline_executions_via_CLI/">14.5. Manage pipeline executions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.6._View_cluster_nodes_via_CLI/">14.6. View cluster nodes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.7._View_and_manage_Permissions_via_CLI/">14.7. View and manage Permissions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.8._View_tools_definitions_via_CLI/">14.8. View tools definitions</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.9._User_management_via_CLI/">14.9. User management</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/14_CLI/14.10._SSH_tunnel/">14.10. SSH tunnel</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">15. Interactive services</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/15_Interactive_services/15._Interactive_services/">15.0. Overview</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/15_Interactive_services/15.1._Starting_an_Interactive_application/">15.1. Starting an interactive application</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/15_Interactive_services/15.2._Using_Terminal_access/">15.2. Using terminal access</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/15_Interactive_services/15.3._Expose_node_filesystem/">15.3. Expose node filesystem</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/15_Interactive_services/15.4._Interactive_service_examples/">15.4. Interactive service examples</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/16_Issues/16._Issues/">16. Issues</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">17. Tagging by attributes</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/17_Tagging_by_attributes/17._CP_objects_tagging_by_additional_attributes/">17.0. CP objects tagging by additional attributes</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../../manual/17_Tagging_by_attributes/17.1._Faceted_filters_search_by_tags/">17.1. Faceted filters search using tags</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/18_Home_page/18._Home_page/">18. Home page</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/19_Search/19._Global_search/">19. Global search</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_A/Appendix_A._Instance_and_Docker_container_lifecycles/">Appendix A. Instance and Docker container lifecycles</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_B/Appendix_B._Working_with_a_Project/">Appendix B. Working with a Project</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_C/Appendix_C._Working_with_autoscaled_cluster_runs/">Appendix C. Working with autoscaled cluster runs</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_D/Appendix_D._Costs_management/">Appendix D. Costs management</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_E/Appendix_E._Pipeline_objects_concept/">Appendix E. Pipeline objects concept</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../manual/Appendix_F/Appendix_F._%D0%A1omparison_of_using_different_FS_storages_%28FSx_for_Lustre_vs_EFS_in_AWS%29/">Appendix F. Сomparison of using different FS storage types</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Pipeline API</span></p>
              <ul>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../api/API_tutorials/API_tutorials/">API tutorials</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../api/API_tutorials/Automation_via_CLI/">Automation via CLI</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../api/API_tutorials/Direct_HTTP_API/">Direct HTTP API implementation</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../../api/API_tutorials/JavaScript_example/">JavaScript example</a>
                  </li>
              </ul>
              <p class="caption"><span class="caption-text">Cloud Pipeline Installation</span></p>
              <ul class="current">
                  <li class="toctree-l1"><a class="reference internal" href="#">Prerequisites</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../prerequisites/common/">General requirements</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../prerequisites/aws/">AWS</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../prerequisites/azure/">Azure</a>
                </li>
                <li class="toctree-l2"><a class="reference internal" href="../../../prerequisites/gcp/">GCP</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1 current"><a class="reference internal current" href="#">Deployment</a>
    <ul class="current">
                <li class="toctree-l2 current"><a class="reference internal current" href="#">AWS</a>
    <ul class="current">
                <li class="toctree-l3 current"><a class="reference internal current" href="./">Terraform</a>
    <ul class="current">
    <li class="toctree-l4"><a class="reference internal" href="#overview">Overview</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#resources-deployment-using-terraform">Resources deployment using Terraform</a>
    </li>
    <li class="toctree-l4"><a class="reference internal" href="#cloud-pipeline-deployment">Cloud-pipeline deployment</a>
    </li>
    </ul>
                </li>
                <li class="toctree-l3"><a class="reference internal" href="../cloud-formation/">AWS CloudFormation</a>
                </li>
    </ul>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="#">Management</a>
    <ul>
                <li class="toctree-l2"><a class="reference internal" href="../../../management/environments_sync/">Environments sync</a>
                </li>
    </ul>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../change_kube_certificates/">Change Kubernetes certificates</a>
                  </li>
                  <li class="toctree-l1"><a class="reference internal" href="../../../support_windows_runs/">Support Windows runs</a>
                  </li>
              </ul>
      </div>
    </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">
      <nav class="wy-nav-top" role="navigation" aria-label="Mobile navigation menu">
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../..">Cloud Pipeline</a>
        
      </nav>
      <div class="wy-nav-content">
        <div class="rst-content"><div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../../.." class="icon icon-home" alt="Docs"></a> &raquo;</li>
          <li>Cloud Pipeline Installation &raquo;</li>
          <li>Deployment &raquo;</li>
          <li>AWS &raquo;</li>
      <li>Terraform</li>
    <li class="wy-breadcrumbs-aside">
    </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
            <div class="section" itemprop="articleBody">
              
                <h1 id="cloud-pipeline-based-on-aws-eks-deployment-step-by-step-guide">Cloud-pipeline based on AWS EKS Deployment step-by-step guide</h1>
<h2 id="overview">Overview</h2>
<p>This document provides a guidance how to deploy infrastructure using terraform and install Cloud-Pipeline on top of it.
The process of the deployment can be performed with the following steps:</p>
<ul>
<li><a href="#cloud-pipeline-based-on-aws-eks-deployment-step-by-step-guide">Cloud-pipeline based on AWS EKS Deployment step-by-step guide</a><ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#resources-deployment-using-terraform">Resources deployment using Terraform</a><ul>
<li><a href="#prerequisites">Prerequisites</a></li>
<li><a href="#jump-server-deployment">Jump-server deployment</a><ul>
<li><a href="#outputs-table-of-jump-server-module">Outputs table of <code>jump-server</code> module</a></li>
</ul>
</li>
<li><a href="#cluster-infrastructure-deployment">Cluster-infrastructure deployment</a><ul>
<li><a href="#outputs-table-of-cluster-infrastructure-module">Outputs table of <code>cluster-infrastructure</code> module</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="#cloud-pipeline-deployment">Cloud-pipeline deployment</a></li>
</ul>
</li>
</ul>
<blockquote>
<p>This guide assumes that you store your terraform root modules in a private git repository and able to clone it from
remote instance.</p>
</blockquote>
<h2 id="resources-deployment-using-terraform">Resources deployment using Terraform</h2>
<p>To get started with deployment, please make sure that you satisfy requirements below.</p>
<h3 id="prerequisites">Prerequisites</h3>
<table>
<thead>
<tr>
<th>Name</th>
<th>Version</th>
</tr>
</thead>
<tbody>
<tr>
<td><a name="requirement_terraform"></a> <a href="#requirement_terraform">terraform</a></td>
<td>= 1.5.0</td>
</tr>
</tbody>
</table>
<p>To install terraform 1.50 on Linux amd64 type of OS you can run commands:</p>
<pre><code>    sudo wget https://releases.hashicorp.com/terraform/1.5.0/terraform_1.5.0_linux_amd64.zip
    sudo unzip terraform_1.5.0_linux_amd64.zip 
    chmod +x terraform
    sudo mv terraform /usr/local/bin/
    sudo rm terraform_1.5.0_linux_amd64.zip
</code></pre>
<p>To install terraform to other operating system please follow the links
https://developer.hashicorp.com/terraform/tutorials/aws-get-started/install-cli <br>
https://developer.hashicorp.com/terraform/install</p>
<ol>
<li>Manually create S3 Bucket to store remote state of the terraform deployment.
   To create S3 bucket you can use AWS Console or aws cli commands:
   a. If region us-east-1
   <code>aws s3api create-bucket --bucket &lt;s3-bucket-for-terraform-state-name-example&gt;</code></li>
</ol>
<p>b. If another region</p>
<p><code>aws s3api create-bucket --region &lt;your deploy aws region&gt;  --bucket &lt;s3-bucket-for-terraform-state-name-example&gt; --create-bucket-configuration LocationConstraint=&lt;your deploy aws region&gt;</code></p>
<ol>
<li>Manually create DynamoDB table to store terraform lock records.<ul>
<li>Table schema:
   <code>LockID (String) - Partition key</code></li>
</ul>
</li>
</ol>
<p>To create DynamoDB table you can use AWS Console or aws cli command:</p>
<p><code>aws dynamodb create-table --table-name &lt;dynamobd-table-to-store-terraform-lock-name-example&gt; --attribute-definitions AttributeName=LockID,AttributeType=S --key-schema AttributeName=LockID,KeyType=HASH --provisioned-throughput ReadCapacityUnits=5,WriteCapacityUnits=5 --region &lt;your deploy aws region&gt;</code></p>
<blockquote>
<p>The following resources are dependencies and should be created in advance:
* VPC in your AWS account
* Private subnets (where all infrastructure will be created: EKS cluster, RDS instance, FS, etc.)
* Mechanism to have inbound access to the VPC (IGW, transit gateway, VPN from corporate network etc.)</p>
</blockquote>
<ol>
<li>AWS Elastic IP allocation. <br>
   Create AWS Elastic IP allocation to provide this value further during Cloud-Pipeline installation.
   This value will be used to deploy AWS ELB in your account to route the traffic from users to Cloud-Pipeline services
   This EIP also should be used to request DNS records creation from you DNS provider. The following scheme of the
   records is proposed:</li>
</ol>
<table>
<thead>
<tr>
<th>DNS record</th>
<th>Record type</th>
<th>Value</th>
</tr>
</thead>
<tbody>
<tr>
<td><cloud-pipeline-name>.<your-domain></td>
<td>A</td>
<td>&lt; EIP value &gt;</td>
</tr>
<tr>
<td>edge.<cloud-pipeline-name>.<your-domain></td>
<td>CNAME</td>
<td><cloud-pipeline-name>.<your-domain></td>
</tr>
<tr>
<td>docker.<cloud-pipeline-name>.<your-domain></td>
<td>CNAME</td>
<td><cloud-pipeline-name>.<your-domain></td>
</tr>
<tr>
<td>git.<cloud-pipeline-name>.<your-domain></td>
<td>CNAME</td>
<td><cloud-pipeline-name>.<your-domain></td>
</tr>
</tbody>
</table>
<h3 id="jump-server-deployment">Jump-server deployment</h3>
<p>To deploy required resources in your environment with terraform, please follow these steps:</p>
<ol>
<li>In the Git repo where you would like to store you terraform code: create directory named, for example,
   <code>jump-server</code> and place Terraform files there: main.tf and output.tf.</li>
</ol>
<p>Templates of the deployment <code>Jump-server</code> files:</p>
<p>main.tf</p>
<pre><code class="language-hcl">terraform {
  backend &quot;s3&quot; {
    bucket         = &quot;xxxxxxxxxxxx-infra&quot;
    key            = &quot;xxxxxx-jumpbox/terraform.tfstate&quot;
    region         = &quot;&lt;region&gt;&quot;
    encrypt        = true
    dynamodb_table = &quot;xxxxxxxxxxxx-infra&quot;
  }
  required_version = &quot;1.5.0&quot;
}

provider &quot;aws&quot; {
  region = &quot;&lt;region&gt;&quot;
}

module jump-server {
  source                            = &quot;git::https://github.com/epam/cloud-pipeline//deploy/infra/aws/terraform/cloud-native/jump-server?ref=&lt;branch-tag-or-commit&gt;&quot;
  project_name                      = &quot;xxxxxxxxxxxx&quot;
  env                               = &quot;xxxxxxx&quot;
  vpc_id                            = &quot;vpc-xxxxxxxxxxxx&quot;
  subnet_id                         = &quot;subnet-xxxxxxxxxxxx&quot;
  iam_role_permissions_boundary_arn = &quot;arn:aws:iam::xxxxxxxxxxxx:policy/eo_role_boundary&quot;
}
</code></pre>
<p>output.tf</p>
<pre><code class="language-hcl">output &quot;instance_connection&quot; {
  value = module.jump-server.output_message
}

output &quot;instance_id&quot; {
  value = module.jump-server.jump_sever_id
}

output &quot;instance_role&quot; {
  value = module.jump-server.jump_server_role
}
</code></pre>
<blockquote>
<p>Change xxxxxxxxxxxx to values that described is list of the variables:</p>
</blockquote>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>bucket</code></td>
<td>Name of the created S3 bucket to store terraform state file. See the <a href="#prerequisites">prerequisites</a></td>
</tr>
<tr>
<td><code>dynamodb_table</code></td>
<td>Name of the created DynamoDB table for terraform. See the <a href="#prerequisites">prerequisites</a></td>
</tr>
<tr>
<td><code>deployment_name</code></td>
<td>Name of the deployment. Will be used as resource name prefix of the created resources (security groups, iam roles etc.)</td>
</tr>
<tr>
<td><code>deployment_env</code></td>
<td>Environment name for the deployment. Will be used as resource name prefix of the created resources (security groups, IAM roles etc.)</td>
</tr>
<tr>
<td><code>vpc_id</code></td>
<td>Id of the VCP to be used for deployment of the bastion instance.</td>
</tr>
<tr>
<td><code>subnet_id</code></td>
<td>Id of the VCP subnet to be used to launch an instance</td>
</tr>
<tr>
<td><code>ami_id</code></td>
<td>(Optional) AMI to be used for bastion ec2 instance. If empty - eks-optimized will be used.</td>
</tr>
<tr>
<td><code>iam_role_permissions_boundary_arn</code></td>
<td>(Optional) Account specific role boundaries which will be applied during jump-server instance profile creation</td>
</tr>
</tbody>
</table>
<ol>
<li>Push created configuration in to your git repository.</li>
<li>From <code>jump-server</code> directory run <code>terraform init</code>command, output of command must be like this:</li>
</ol>
<pre><code>Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.
</code></pre>
<ol>
<li>After successful output of the terraform init command run <code>terraform apply</code> and when it shows list of the planned for
   creation
   resources submit with <strong>yes</strong>.</li>
</ol>
<p>Example of the <strong>apply</strong> output:</p>
<pre><code>Apply complete! Resources: .....
Outputs:
instance_connection = &quot;Login to Jump Server with command: aws ssm start-session --target i-xxxxxxxxxxx --region &lt;region&gt;&quot;
instance_id = &quot;i-xxxxxxxxxxxx&quot;
instance_role = &quot;arn:aws:iam::xxxxxxxxxxx:role/xxxxxxxxxxx_BastionExecutionRole&quot;
</code></pre>
<h4 id="outputs-table-of-jump-server-module">Outputs table of <code>jump-server</code> module</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>instance_connection</code></td>
<td>Id of created Jump Server instance.</td>
</tr>
<tr>
<td><code>instance_id</code></td>
<td>Login to Jump Server with command: aws ssm start-session --target ${module.ec2_instance.id} --region ${data.aws_region.current.name}.</td>
</tr>
<tr>
<td><code>instance_role</code></td>
<td>ARN of bastion execution role that must be set in EKS deployment module</td>
</tr>
</tbody>
</table>
<blockquote>
<p>User can call terraform output again by run command:</p>
</blockquote>
<pre><code class="language-hcl">   terraform output &lt;output name from table above&gt;
</code></pre>
<blockquote>
<p>Note: In most cases this command will only show output after resources were deployed with terraform apply command.</p>
</blockquote>
<h3 id="cluster-infrastructure-deployment">Cluster-infrastructure deployment</h3>
<ol>
<li>In the Git repo where you would like to store you terraform code: create directory named, for example,
   <code>cluster-infrastructure</code> and place your Terraform files: main.tf, output.tf and if you would like to deploy
   cloud-pipeline databases configuration - versions.tf.</li>
</ol>
<p>Template of the <code>cluster-infrastructure</code> files deployment:</p>
<p>main.tf</p>
<pre><code class="language-hcl">terraform {
  backend &quot;s3&quot; {
    bucket         = &quot;xxxxxxxxxxxx-infra&quot;
    key            = &quot;eks/terraform.tfstate&quot;
    region         = &quot;&lt;region&gt;&quot;
    encrypt        = true
    dynamodb_table = &quot;xxxxxxxxxxxx-infra&quot;
  }
  required_version = &quot;1.5.0&quot;
}

provider &quot;aws&quot; {
  region = &quot;&lt;region&gt;&quot;
}

provider &quot;kubernetes&quot; {
  host                   = module.cluster-infra.cluster_endpoint
  cluster_ca_certificate = base64decode(module.cluster-infra.cluster_certificate_authority_data)

  exec {
    api_version = &quot;client.authentication.k8s.io/v1beta1&quot;
    command = &quot;aws&quot;
    # This requires the awscli to be installed locally where Terraform is executed
    args        = [&quot;eks&quot;, &quot;get-token&quot;, &quot;--cluster-name&quot;, module.cluster-infra.cluster_name]
  }
}

provider &quot;helm&quot; {
  kubernetes {
    host                   = module.cluster-infra.cluster_endpoint
    cluster_ca_certificate = base64decode(module.cluster-infra.cluster_certificate_authority_data)

    exec {
      api_version = &quot;client.authentication.k8s.io/v1beta1&quot;
      command = &quot;aws&quot;
      # This requires the awscli to be installed locally where Terraform is executed
      args        = [&quot;eks&quot;, &quot;get-token&quot;, &quot;--cluster-name&quot;, module.cluster-infra.cluster_name]
    }
  }
}

provider &quot;postgresql&quot; {
  host      = module.cluster-infra.rds_address
  port      = module.cluster-infra.rds_port
  username  = module.cluster-infra.rds_root_username
  password  = module.cluster-infra.rds_root_pass_secret
  superuser = false
}

module &quot;cluster-infra&quot; {
  source                             = &quot;git::https://github.com/epam/cloud-pipeline//deploy/infra/aws/terraform/cloud-native/cluster-infra?ref=&lt;branch-tag-or-commit&gt;&quot;
  deployment_name                    = &quot;xxxxxxxxxxxx&quot;
  deployment_env                     = &quot;xxxxxxxxxxxx&quot;
  vpc_id                             = &quot;vpc-xxxxxxxxxxxx&quot;
  external_access_security_group_ids = [&quot;xxxxxxxxxxxx&quot;]
  subnet_ids                         = [&quot;subnet-xxxxxxxxxxxx&quot;, &quot;subnet-xxxxxxxxxxxx&quot;, &quot;subnet-xxxxxxxxxxxx&quot;]
  iam_role_permissions_boundary_arn  = &quot;arn:aws:iam::xxxxxxxxxxxx:policy/eo_role_boundary&quot;
  eks_system_node_group_subnet_ids   = [&quot;subnet-xxxxxxxxxxxx&quot;]
  deploy_filesystem_type             = &quot;xxxxxxxxxxxx&quot;
  cp_deployment_id                   = &quot;xxxxxxxxxxxx&quot;
  cp_edge_elb_schema                 = &quot;xxxxxxxxxxxx&quot;
  cp_edge_elb_subnet                 = &quot;xxxxxxxxxxxx&quot;
  cp_edge_elb_ip                     = &quot;xxxxxxxxxxxx&quot;
  cp_api_srv_host                    = &quot;xxxxxxxxxxxx&quot;
  cp_idp_host                        = &quot;xxxxxxxxxxxx&quot;
  cp_docker_host                     = &quot;xxxxxxxxxxxx&quot;
  cp_edge_host                       = &quot;xxxxxxxxxxxx&quot;
  cp_gitlab_host                     = &quot;xxxxxxxxxxxx&quot;
  eks_additional_role_mapping        = [
    {
      iam_role_arn  = &quot;arn:aws:iam::xxxxxxxxxxxx:role/xxxxxxxxxx-BastionExecutionRole&quot;
      eks_role_name = &quot;system:node:{{EC2PrivateDNSName}}&quot;
      eks_groups    = [&quot;system:bootstrappers&quot;, &quot;system:nodes&quot;]
    }
  ]
}  
</code></pre>
<p>versions.tf (if Cloud-Pipepline database configuration should be deployed):</p>
<pre><code class="language-hcl">terraform {
  required_providers {
    postgresql = {
      source  = &quot;cyrilgdn/postgresql&quot;
      version = &quot;1.21.0&quot;
    }
  }
}
</code></pre>
<p>output.tf</p>
<pre><code class="language-hcl">output &quot;filesystem_mount&quot; {
  value = module.cluster-infra.cp_filesystem_mount_point
}

output &quot;filesystem_type&quot; {
  value = module.cluster-infra.deploy_filesystem_type
}

output &quot;cp_pipectl_script&quot; {
  value = module.cluster-infra.cp_deploy_script
}


</code></pre>
<p>To configure <code>cluster-infrastructure</code> deployment, there is a list of variables that need to be specified:</p>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>deployment_name</code></td>
<td>Name of the deployment. Will be used as resource name prefix of the created resources (security groups, IAM roles etc.)</td>
</tr>
<tr>
<td><code>deployment_env</code></td>
<td>Environment name for the deployment. Will be used as resource name prefix of the created resources (security groups, IAM roles etc.)</td>
</tr>
<tr>
<td><code>vpc_id</code></td>
<td>Id of the VCP to be used for deployment of the infrastructure.</td>
</tr>
<tr>
<td><code>subnet_ids</code></td>
<td>Ids of the VCP subnets to be used for Cloud Pipeline EKS cluster, FS mount points, etc.</td>
</tr>
<tr>
<td><code>external_access_security_group_ids</code></td>
<td>Ids of the SGs to be attached to the ELB to allow traffic from users to the platform. Created as prerequisites by administrator who is deploying the system, with regard to organisational network policies and best practices.</td>
</tr>
<tr>
<td><code>eks_system_node_group_subnet_ids</code></td>
<td>Ids of the VCP subnets to be used for EKS cluster Cloud Pipeline system node group.</td>
</tr>
<tr>
<td><code>eks_additional_role_mapping</code></td>
<td>List of additional roles mapping for aws_auth map.</td>
</tr>
<tr>
<td><code>deploy_filesystem_type</code></td>
<td>(Optional) Option to create EFS or FSx Lustre filesystem: must be set efs or fsx. If empty, no FS will be created. Default efs.</td>
</tr>
<tr>
<td><code>cloud_pipeline_db_configuration</code></td>
<td>(Optional) Username with password and database, which will be created. Username will be owner of the database. Additional settings with Postgresql provider and versions.tf file must be set. For example see <a href="#cluster-infrastructure-deployment">main.tf</a> of the cluster deployment</td>
</tr>
<tr>
<td><code>iam_role_permissions_boundary_arn</code></td>
<td>(Optional) Account specific role boundaries which will be applied during jump-server instance profile creation</td>
</tr>
<tr>
<td><code>deploy_rds</code></td>
<td>(Optional) You can disable deployment of the RDS instance by setting deploy_rds = false. In this case no db configuration will be created regardless the value of create_cloud_pipeline_db_configuration</td>
</tr>
<tr>
<td><code>create_cloud_pipeline_db_configuration</code></td>
<td>(Optional) You can disable creation of the cloud-pipeline database configuration by setting to false</td>
</tr>
<tr>
<td><code>cp_deployment_id</code></td>
<td>(Optional) Specify unique ID of the Cloud-Pipeline deployment. It will be used to name cloud entities (e.g. path within a docker registry object container).Must contain only letters, digits, underscore or dash</td>
</tr>
<tr>
<td><code>cp_edge_elb_schema</code></td>
<td>(Required) Type of the AWS ELB to provide access to the users to the system. Possible values 'internal', 'internet-facing'. Default 'internet-facing'.</td>
</tr>
<tr>
<td><code>cp_edge_elb_subnet</code></td>
<td>(Required) The ID of the public subnet for the Load Balancer to be created. Must be in the same Availability Zone (AZ) as the CPSystemSubnetId</td>
</tr>
<tr>
<td><code>cp_edge_elb_ip</code></td>
<td>(Required) Allocation ID of the Elastic IP from prerequisites in case of internet-facing ELB, or private IP in case of internal ELB.</td>
</tr>
<tr>
<td><code>cp_api_srv_host</code></td>
<td>(Required) API service domain name address.</td>
</tr>
<tr>
<td><code>cp_idp_host</code></td>
<td>(Optional) Self hosted IDP service domain name address. WARNING: Using self hosted IDP service in production environment strongly not recommended!</td>
</tr>
<tr>
<td><code>cp_docker_host</code></td>
<td>(Required) Docker service domain name address.</td>
</tr>
<tr>
<td><code>cp_edge_host</code></td>
<td>(Required) EDGE service domain name address.</td>
</tr>
<tr>
<td><code>cp_gitlab_host</code></td>
<td>(Required) GITLAB service domain name address.</td>
</tr>
</tbody>
</table>
<ol>
<li>Push created configuration in to your git repository.</li>
<li>Install aws ssm
   manager: https://docs.aws.amazon.com/systems-manager/latest/userguide/session-manager-working-with-install-plugin.html</li>
<li>Connect to created jump-server instance using command like:</li>
</ol>
<pre><code>aws ssm start-session --target i-xxxxxxxxxxxxx --region &lt;region&gt;
</code></pre>
<p>Where xxxxxxxx is your jump-server instance ID that could be found(also with full command)
from <a href="#output-of-jump-server-module">output</a> of the <code>terraform apply</code> jump-server deployment.</p>
<ol>
<li>Clone from your git repository pushed previously configuration.</li>
<li>From <code>cluster-infrastructure</code> directory run <code>terraform init</code>command, output of command must be like this:</li>
</ol>
<pre><code>Terraform has been successfully initialized!

You may now begin working with Terraform. Try running &quot;terraform plan&quot; to see
any changes that are required for your infrastructure. All Terraform commands
should now work.
</code></pre>
<ol>
<li>After successful output of the init command run <code>terraform apply</code> and when it shows list of the planned for creation
   resources submit with <strong>yes</strong>.</li>
</ol>
<p>The output can be different depending on terraform options like cp_idp_host or enable_aws_omics_integration.</p>
<p>Example of the <strong>apply</strong> output:</p>
<pre><code>Apply complete! Resources: .....

Outputs:

cp_pipectl_script = &lt;&lt;EOT
./pipectl install \
-dt aws-native \
-jc \
-env CP_MAIN_SERVICE_ROLE=&quot;arn:aws:iam::xxxxxxxxxxxxxxx:role/xxxxxxxxxxxxxxxCPExecutionRole&quot; \
-env CP_CSI_DRIVER_TYPE=&quot;efs&quot; \
-env CP_SYSTEM_FILESYSTEM_ID=&quot;fs-xxxxxxxxxxxxxxx&quot; \
-env CP_SYSTEM_FILESYSTEM_MOUNTNAME=&quot;&quot; \
-env CP_CSI_EXECUTION_ROLE=&quot;arn:aws:iam::xxxxxxxxxxxxxxx:role/xxxxxxxxxxxxxxx-ExecutionRole&quot; \
-env CP_DOCKER_DIST_SRV=&quot;quay.io/&quot; \
-env CP_AWS_KMS_ARN=&quot;arn:aws:kms:xxxxxxxxxxxxxxx:xxxxxxxxxxxxxxx:key/xxxxxxxxxxxxxxx&quot; \
-env CP_PREF_CLUSTER_SSH_KEY_NAME=&quot;xxxxxxxxxxxxxxx&quot; \
-env CP_PREF_CLUSTER_INSTANCE_SECURITY_GROUPS=&quot;sg-xxxxxxxxxxxxxxx&quot; \
-env CP_PREF_STORAGE_TEMP_CREDENTIALS_ROLE=&quot;arn:aws:iam::xxxxxxxxxxxxxxx:role/xxxxxxxxxxxxxxxS3viaSTSRole&quot; \
-env CP_CLUSTER_SSH_KEY=&quot;/opt/root/ssh/ssh-key.pem&quot; \
-env CP_DOCKER_STORAGE_TYPE=&quot;obj&quot; \
-env CP_DOCKER_STORAGE_CONTAINER=&quot;xxxxxxxxxxxxxxx-docker&quot; \
-env CP_DEPLOYMENT_ID=&quot;&lt;users deployment id&gt;&quot; \
-env CP_PREF_UI_PIPELINE_DEPLOYMENT_NAME=&quot;&lt;users deployment name&gt;&quot; \
-env CP_CLOUD_REGION_ID=&quot;xxxxxxxxxxxxxxx&quot; \
-env CP_KUBE_CLUSTER_NAME=&quot;xxxxxxxxxxxxxxx-eks-cluster&quot; \
-env CP_KUBE_EXTERNAL_HOST=&quot;https://xxxxxxxxxxxxxxx.gr7.xxxxxxxxxxxxxxx.eks.amazonaws.com&quot; \
-env CP_KUBE_SERVICES_TYPE=&quot;ingress&quot; \
--external-host-dns \
-env PSG_HOST=&quot;xxxxxxxxxxxxxxx-rds.xxxxxxxxxxxxxxx.xxxxxxxxxxxxxxx.rds.amazonaws.com&quot; \
-env PSG_PASS=&quot;pipeline&quot; \
-env PSG_CONNECT_PARAMS=&quot;?ssl=true&amp;sslfactory=org.postgresql.ssl.NonValidatingFactory&quot; \
-s cp-api-srv \
-env CP_API_SRV_EXTERNAL_PORT=443 \
-env CP_API_SRV_INTERNAL_PORT=443 \
-env CP_API_SRV_EXTERNAL_HOST=&quot;&lt;user-domain-name&gt;&quot; \
-env CP_API_SRV_INTERNAL_HOST=&quot;&lt;user-domain-name&gt;&quot; \
-env CP_API_SRV_IDP_CERT_PATH=&quot;/opt/idp/pki&quot; \
-env CP_PREF_UI_PIPELINE_DEPLOYMENT_NAME=&quot;&lt;users deployment name&gt;&quot; \
-env CP_PREF_STORAGE_SYSTEM_STORAGE_NAME=&quot;xxxxxxxxxxxxxxx&quot; \
-env CP_API_SRV_SSO_BINDING=&quot;urn:oasis:names:tc:SAML:2.0:bindings:HTTP-POST&quot; \
-env CP_API_SRV_SAML_ALLOW_ANONYMOUS_USER=&quot;true&quot; \
-env CP_API_SRV_SAML_AUTO_USER_CREATE=&quot;EXPLICIT&quot; \
-env CP_API_SRV_SAML_GROUPS_ATTRIBUTE_NAME=&quot;Group&quot; \
-env CP_HA_DEPLOY_ENABLED=&quot;true&quot; \
-s cp-docker-registry \
-env CP_DOCKER_EXTERNAL_PORT=443 \
-env CP_DOCKER_INTERNAL_PORT=443 \
-env CP_DOCKER_EXTERNAL_HOST=&quot;docker.&lt;user-domain-name&gt;&quot; \
-env CP_DOCKER_INTERNAL_HOST=&quot;docker.&lt;user-domain-name&gt;&quot; \
-env CP_DOCKER_STORAGE_ROOT_DIR=&quot;/docker-pub/&quot; \
-s cp-edge \
-env CP_EDGE_EXTERNAL_PORT=443 \
-env CP_EDGE_INTERNAL_PORT=443 \
-env CP_EDGE_EXTERNAL_HOST=&quot;edge.&lt;user-domain-name&gt;&quot; \
-env CP_EDGE_INTERNAL_HOST=&quot;edge.&lt;user-domain-name&gt;&quot; \
-env CP_EDGE_WEB_CLIENT_MAX_SIZE=0 \
-s cp-clair \
-env CP_CLAIR_DATABASE_HOST=&quot;xxxxxxxxxxxxxxx-rds.xxxxxxxxxxxxxxx.xxxxxxxxxxxxxxx.rds.amazonaws.com&quot; \
-env CP_CLAIR_DATABASE_PASSWORD=&quot;clair&quot; \
-env CP_CLAIR_DATABASE_SSL_MODE=&quot;require&quot; \
-s cp-docker-comp \
-env CP_DOCKER_COMP_WORKING_DIR=&quot;/cloud-pipeline/docker-comp/wd&quot; \
-s cp-search \
-s cp-heapster \
-s cp-dav \
-env CP_DAV_AUTH_URL_PATH=&quot;webdav/auth-sso&quot; \
-env CP_DAV_MOUNT_POINT=&quot;/dav-mount&quot; \
-env CP_DAV_SERVE_DIR=&quot;/dav-serve&quot; \
-env CP_DAV_URL_PATH=&quot;webdav&quot; \
-s cp-gitlab-db \
-env GITLAB_DATABASE_VERSION=&quot;12.18&quot; \
-s cp-git \
-env CP_GITLAB_VERSION=15 \
-env CP_GITLAB_SESSION_API_DISABLE=&quot;true&quot; \
-env CP_GITLAB_API_VERSION=v4 \
-env CP_GITLAB_EXTERNAL_PORT=443 \
-env CP_GITLAB_INTERNAL_PORT=443 \
-env CP_GITLAB_EXTERNAL_HOST=&quot;git.&lt;user-domain-name&gt;&quot; \
-env CP_GITLAB_INTERNAL_HOST=&quot;git.&lt;user-domain-name&gt;&quot; \
-env CP_GITLAB_EXTERNAL_URL=&quot;https://git.&lt;user-domain-name&gt;&quot; \
-env CP_GITLAB_IDP_CERT_PATH=&quot;/opt/idp/pki&quot; \
-s cp-git-sync \
-s cp-billing-srv \
-env CP_BILLING_DISABLE_GS=&quot;true&quot; \
-env CP_BILLING_DISABLE_AZURE_BLOB=&quot;true&quot; \
-env CP_BILLING_CENTER_KEY=&quot;billing-group&quot; \
-s cp-idp \
-env CP_IDP_EXTERNAL_HOST=&quot;auth.&lt;user-domain-name&gt;&quot; \
-env CP_IDP_INTERNAL_HOST=&quot;auth.&lt;user-domain-name&gt;&quot; \
-env CP_IDP_EXTERNAL_PORT=443 \
-env CP_IDP_INTERNAL_PORT=443 \
-env CP_PREF_AWS_OMICS_SERVICE_ROLE=arn:aws:iam::xxxxxxxxxxxxxxx:role/xxxxxxxxxxxxxxxOmicsServiceRole \
-env CP_PREF_AWS_OMICS_ECR_REGISTRY=xxxxxxxxxxxxxxx.dkr.ecr.xxxxxxxxxxxxxxx.amazonaws.com \
-env CP_EDGE_AWS_ELB_SCHEME=&quot;internet-facing&quot; \
-env CP_EDGE_AWS_ELB_SUBNETS=&quot;subnet-xxxxxxxxxxxxxxx&quot; \
-env CP_EDGE_AWS_ELB_SG=&quot;,sg-xxxxxxxxxxxxxxx,sg-xxxxxxxxxxxxxxx&quot; \
-env CP_EDGE_AWS_ELB_EIPALLOCS=&quot;eipalloc-xxxxxxxxxxxxxxx&quot; \
-env CP_EDGE_KUBE_SERVICES_TYPE=elb
EOT

filesystem_mount = &quot;fs-xxxxxxxxxxxxxxx.efs.xxxxxxxxxxxxxxx.amazonaws.com:/&quot;
filesystem_type = &quot;efs&quot;
</code></pre>
<h4 id="outputs-table-of-cluster-infrastructure-module">Outputs table of <code>cluster-infrastructure</code> module</h4>
<table>
<thead>
<tr>
<th>Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td></td>
<td></td>
</tr>
</tbody>
</table>
<p>| <code>filesystem_mount</code>  | Filesystem mount endpoint that can be used to mount ElasticFileSystem in EC2 JumpServer |
| <code>filesystem_type</code>   | Type of the created internet file system |
| <code>cp_pipectl_script</code> | Example of the pipeline install script with all necessary values from infrastructure
deployment |</p>
<blockquote>
<p>User can call terraform output again by run command:</p>
</blockquote>
<pre><code class="language-hcl">   terraform output &lt;output name from table above&gt;
</code></pre>
<blockquote>
<p>Note: You should deploy infrastructure first, to see output values.</p>
</blockquote>
<h2 id="cloud-pipeline-deployment">Cloud-pipeline deployment</h2>
<ol>
<li>Download latest pipectl binary file.</li>
<li>
<p>Mount created file system into instance.</p>
<ul>
<li>
<p>For EFS run commands (https://docs.aws.amazon.com/efs/latest/ug/mounting-fs-mount-cmd-dns-name.html):
<code>fs_mount=$(terraform output -raw filesystem_mount)
sudo yum install amazon-efs-utils -y 
sudo mount -t efs -o tls $fs_mount  /opt</code></p>
</li>
<li>
<p>For FSx for Lustre (https://docs.aws.amazon.com/fsx/latest/LustreGuide/mounting-ec2-instance.html):
<code>fs_mount=$(terraform output -raw filesystem_mount)
sudo amazon-linux-extras install -y lustre
sudo mount -t lustre -o relatime,flock $fs_mount /opt</code></p>
</li>
</ul>
</li>
<li>
<p>Create ssh key from <code>cluster-infrastructure</code> deployment:</p>
</li>
</ol>
<pre><code>sudo mkdir -p /opt/root/ssh

terraform show -json | jq -r &quot;.values.root_module.child_modules[].resources[] |  select(.address==\&quot;$(terraform state list | grep ssh_tls_key)\&quot;) |.values.private_key_pem&quot; &gt; /opt/root/ssh/ssh-key.pem
</code></pre>
<ol>
<li>Take script from the <code>cluster-infrastructure</code> deployment <a href="#output-of-cluster-infrastructure-module">output</a> and
   run it by using bash commands. For example:</li>
</ol>
<pre><code>CP_PIPECTL_URL=https://cloud-pipeline-oss-builds.s3.amazonaws.com/builds/&lt;link-to-the-desired-pipectl-version&gt; \

wget -c $CP_PIPECTL_URL -O pipectl &amp;&amp; chmod +x pipectl \

terraform output -raw cp_pipectl_script &gt; &quot;deploy_cloud_pipeline.sh&quot; &amp;&amp; \

chmod +x deploy_cloud_pipeline.sh \

./deploy_cloud_pipeline.sh &amp;&gt; pipectl.log
</code></pre>
<ol>
<li>Wait until deployment finishes.</li>
<li>Your Cloud-Pipeline environment should be available on the provided DNS name provided during
   deployment (<code>cp_api_srv_host</code>). </li>
</ol>
              
            </div>
          </div><footer>
    <div class="rst-footer-buttons" role="navigation" aria-label="Footer Navigation">
        <a href="../../../prerequisites/gcp/" class="btn btn-neutral float-left" title="GCP"><span class="icon icon-circle-arrow-left"></span> Previous</a>
        <a href="../cloud-formation/" class="btn btn-neutral float-right" title="AWS CloudFormation">Next <span class="icon icon-circle-arrow-right"></span></a>
    </div>

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
  </div>

  Built with <a href="https://www.mkdocs.org/">MkDocs</a> using a <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
          
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" aria-label="Versions">
  <span class="rst-current-version" data-toggle="rst-current-version">
    
    
      <span><a href="../../../prerequisites/gcp/" style="color: #fcfcfc">&laquo; Previous</a></span>
    
    
      <span><a href="../cloud-formation/" style="color: #fcfcfc">Next &raquo;</a></span>
    
  </span>
</div>
    <script>var base_url = '../../../..';</script>
    <script src="../../../../js/theme_extra.js" defer></script>
    <script src="../../../../js/theme.js" defer></script>
      <script src="../../../../css/extra.js" defer></script>
      <script src="../../../../search/main.js" defer></script>
    <script defer>
        window.onload = function () {
            SphinxRtdTheme.Navigation.enable(true);
        };
    </script>

</body>
</html>
