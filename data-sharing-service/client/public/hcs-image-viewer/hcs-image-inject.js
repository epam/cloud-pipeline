(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{2221:function(e,t,n){"use strict";n.r(t),n.d(t,{default:function(){return lt}});var r=n(7462),o=n(7294),i=n(3935),c=n(4942),a=n(9439),s=n(5697),l=n.n(s),u=n(4337),f=n(5671),d=n(3144),p=n(1752),v=n(136),h=n(4575),m=n(1120),b=n(5861),y=n(7757),g=n.n(y),O=n(4088),w=n(8918),j=n(3121);function P(e){var t=e[e.length-1];return 3===t||4===t}function C(e){if(e&&e.shape){var t=P(e.shape),n=e.shape.slice(t?-3:-2),r=(0,a.Z)(n,2);return{height:r[0],width:r[1]}}}var k,Z={column:-1,row:-1},S=function(e){(0,v.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,h.Z)(this,e)});function o(){return(0,f.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){for(var e=this.props,t=e.loader,n=e.id,r=e.mesh,o=void 0===r?{}:r,i=e.hoveredCell,c=o.rows,a=void 0===c?0:c,s=o.columns,l=void 0===s?0:s,u=o.cells,f=void 0===u?[]:u,d=C(t[0])||{},p=d.width,v=void 0===p?0:p,h=d.height,m=[],b=v/l,y=(void 0===h?0:h)/a,g=function(e,t){return[e*b,t*y]},w=function(e,t){return[g(e,t),g(e+1,t),g(e+1,t+1),g(e,t+1)]},P=0;P<a;P+=1)for(var k=0;k<l;k+=1)m.push({column:k,row:P});var S=function(e){return e&&i&&i.column===e.column&&i.row===e.row};return m.sort((function(e,t){return Number(S(e))-Number(S(t))})),[new j.Z({id:"line-".concat(n),coordinateSystem:O.Df.CARTESIAN,data:m,getPolygon:function(e){return w(e.column,e.row)},getLineWidth:function(e){return S(e)?2:1},lineWidthUnits:"pixels",getLineColor:function(e){return S(e)?[220,220,220]:[120,120,120]},filled:!1,stroked:!0,updateTriggers:{getLineColor:[i||Z]}}),new j.Z({id:"cell-".concat(n),coordinateSystem:O.Df.CARTESIAN,data:f,getPolygon:function(e){return w(e.column,e.row)},filled:!0,stroked:!1,pickable:!0,getFillColor:[255,255,255,0]})]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t),!0}}]),o}(w.Z);S.layerName="CollageMeshLayer",S.defaultProps={loader:{type:"object",value:{getRaster:(k=(0,b.Z)(g().mark((function e(){return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)}))),function(){return k.apply(this,arguments)}),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"collage-mesh-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{rows:0,columns:0},compare:!0},onHover:{type:"function",value:function(){},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var x=S;function D(e){return"-#".concat(e,"#")}function E(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function L(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?E(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):E(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var R=function(e){(0,v.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,h.Z)(this,e)});function o(e){var t;(0,f.Z)(this,o),t=r.call(this,e);var n=e.mesh,i=e.onCellHover,c=e.hoveredCell,a=e.onCellClick;return t.onCellHover=i,t.hoveredCell=c,t.onCellClick=a,t.mesh=n,t}return(0,d.Z)(o,[{key:"getLayers",value:function(e){var t=e.viewStates,n=e.props,r=(0,p.Z)((0,m.Z)(o.prototype),"getLayers",this).call(this,{viewStates:t,props:n}),i=n.loader,c=this.id,a=this.height,s=this.width,l=t[c];return this.mesh&&r.push(new x(L(L({},n),{},{loader:i,id:"mesh-".concat(D(c)),mesh:L({},this.mesh),viewState:L(L({},l),{},{height:a,width:s}),onHover:this.onCellHover,onClick:this.onCellClick,hoveredCell:this.hoveredCell}))),r}}]),o}(u.O6);function z(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function M(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?z(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):z(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var I=function(e){var t=e.loader,n=e.contrastLimits,r=e.colors,i=e.channelsVisible,c=e.viewStates,s=void 0===c?[]:c,l=e.colormap,f=e.overview,d=e.overviewOn,p=e.selections,v=e.hoverHooks,h=void 0===v?{handleValue:function(){},handleCoordinate:function(){}}:v,m=e.height,b=e.width,y=e.lensEnabled,g=void 0!==y&&y,O=e.lensSelection,w=void 0===O?0:O,j=e.lensRadius,P=void 0===j?100:j,C=e.lensBorderColor,k=void 0===C?[255,255,255]:C,Z=e.lensBorderRadius,S=void 0===Z?.02:Z,x=e.clickCenter,D=void 0===x||x,E=e.transparentColor,L=e.onViewStateChange,z=e.onHover,I=e.onViewportLoad,V=e.extensions,A=void 0===V?[]:V,B=e.deckProps,H=e.mesh,T=e.onCellClick,N=null==s?void 0:s.find((function(e){return e.id===u.ys})),U=(0,o.useMemo)((function(){return N||(0,u.TI)(t,{height:m,width:b},.5)}),[t,N]),F=(0,o.useState)(void 0),G=(0,a.Z)(F,2),W=G[0],$=G[1],_=(0,o.useCallback)((function(e){e&&!W?$(e):e?e&&W&&e.column!==W.column&&e.row!==W.row&&$(e):$(e)}),[W,$]),q=new R({id:u.ys,height:m,width:b,mesh:H,onCellHover:_,hoveredCell:W,onCellClick:T}),J={loader:t,contrastLimits:n,colors:r,channelsVisible:i,selections:p,onViewportLoad:I,colormap:l,lensEnabled:g,lensSelection:w,lensRadius:P,lensBorderColor:k,lensBorderRadius:S,extensions:A,transparentColor:E},K=[],Q=[],X=[];if(K.push(q),Q.push(J),X.push(M(M({},U),{},{id:u.ys})),d&&t){var Y=(null==s?void 0:s.find((function(e){return e.id===u.cl})))||M(M({},U),{},{id:u.cl}),ee=new u.A6(M({id:u.cl,loader:t,detailHeight:m,detailWidth:b,clickCenter:D},f));K.push(ee),Q.push(M(M({},J),{},{lensEnabled:!1})),X.push(Y)}return t?o.createElement(u.iP,{layerProps:Q,views:K,viewStates:X,hoverHooks:h,onViewStateChange:L,onHover:z,deckProps:B}):null},V="set-data",A="set-source-initializing",B="set-source",H="set-source-error",T="set-image",N="set-image-viewport-loaded";function U(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function F(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?U(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):U(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function G(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function W(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?G(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):G(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function $(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function _(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?$(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):$(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var q=function(e,t){switch(t.type){case V:return function(e,t){var n=t.url,r=t.offsetsUrl,o=t.callback,i=e.url,c=e.offsetsUrl;return i===n&&r===c?(o&&o(),e):F(F({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,imageTimePosition:0,imageZPosition:0,mesh:void 0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:o,error:void 0,url:n,offsetsUrl:r})}(e,t);case"set-error":return function(e,t){var n=t.error;return W(W({},e),{},{error:n})}(e,t);case A:return function(e){return _(_({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0,imagePending:!1})}(e);case H:return function(e,t){var n=t.error,r=e.sourceCallback;return"function"==typeof r&&setTimeout((function(){r({error:n})}),0),_(_({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:n,sourcePending:!1,sourceCallback:void 0})}(e,t);case B:return function(e,t){var n=t.source,r=e.sourceCallback;"function"==typeof r&&setTimeout((function(){r()}),0);var o=Array.isArray(n)?n:[n],i=o.map((function(e){return e.data})),c=o.map((function(e){return e.metadata}));return _(_({},e),{},{loader:i,metadata:c,imageIndex:0,source:n,sourceError:void 0,sourcePending:!1,sourceCallback:void 0})}(e,t);case T:return function(e,t){var n,r=t.index,o=t.ID,i=t.Name,c=t.search,s=t.imageTimePosition,l=void 0===s?0:s,u=t.imageZPosition,f=void 0===u?0:u,d=t.mesh,p=e.metadata,v=void 0===p?[]:p;if(null!=r)n=v[r];else if(void 0!==o)n=v.find((function(e){return e.ID===o}));else if(void 0!==i)n=v.find((function(e){return(e.Name||e.name||"").toLowerCase()===i.toLowerCase()}));else if(c&&/^[\d]+_[\d]+$/.test(c)){var h=/^([\d]+)_([\d])+$/.exec(c),m=(0,a.Z)(h,3),b=m[1],y=m[2],g=new RegExp("^\\s*well\\s+".concat(b,"\\s*,\\s*field\\s+").concat(y,"\\s*$"),"i");n=v.find((function(e){return g.test(e.Name||e.name)}))}if(n){var O=v.indexOf(n);return _(_({},e),{},{imageIndex:O,imagePending:!0,imageTimePosition:l,imageZPosition:f,mesh:d})}return e}(e,t);case N:return function(e){return _(_({},e),{},{imagePending:!1})}(e);case"set-mesh":return function(e,t){var n=t.mesh;return _(_({},e),{},{mesh:n})}(e,t);default:return e}},J=n(2407),K=n(265);var Q=function(e){(0,v.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,h.Z)(this,e)});function o(e){var t;return(0,f.Z)(this,o),t=e?r.call(this,"offsets.json file not found: ".concat(e)):r.call(this,"offsets.json file not specified"),(0,h.Z)(t)}return(0,d.Z)(o)}((0,J.Z)(Error));function X(e,t,n){return Y.apply(this,arguments)}function Y(){return(Y=(0,b.Z)(g().mark((function e(t,n,r){var o,i,c,a,s,l,u,f,d;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,(0,K.W0)(t);case 2:return i=e.sent,e.next=5,i.getImage(0);case 5:if(c=e.sent,!Boolean(null==c||null===(o=c.fileDirectory)||void 0===o?void 0:o.SubIFDs)){e.next=9;break}return e.abrupt("return",n.reduce((function(e,t){var n=t.Pixels;return n.SizeC*n.SizeT*n.SizeZ+e}),1));case 9:return a=r[0].length,s=n[0].Pixels,l=s.SizeC,u=s.SizeT,f=s.SizeZ,d=l*u*f,e.abrupt("return",d*a);case 13:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function ee(){return ee=(0,b.Z)(g().mark((function e(){var t,n,r,o,i,c,a,s=arguments;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(t=s.length>0&&void 0!==s[0]?s[0]:{},n=t.url,!(r=t.offsetsUrl)){e.next=8;break}return e.next=5,fetch(r);case 5:e.t0=e.sent,e.next=9;break;case 8:e.t0=void 0;case 9:if(o=e.t0,i=!o||!o.ok){e.next=17;break}return e.next=14,o.json();case 14:e.t1=e.sent,e.next=18;break;case 17:e.t1=void 0;case 18:return c=e.t1,e.next=21,(0,u.$L)(n,{offsets:c,images:"all"});case 21:if(a=e.sent,!i){e.next=28;break}return e.next=25,X(n,a.map((function(e){return e.metadata})),a.map((function(e){return e.data})));case 25:if(!(e.sent>40)){e.next=28;break}throw new Q(r);case 28:return e.abrupt("return",a);case 29:case"end":return e.stop()}}),e)}))),ee.apply(this,arguments)}var te="set-default",ne="set-loading",re="set-loaded",oe="set-error",ie="set-channel-properties",ce="set-color-map",ae="set-lens-channel",se="set-lens-enabled",le="set-global-position",ue="set-lock-channels";function fe(){var e=[];return{identifiers:[],channels:[],channelsVisibility:[],selections:e,builtForSelections:e,globalSelection:void 0,colors:[],domains:[],realDomains:[],contrastLimits:[],useLens:!1,useColorMap:!1,colorMap:"",lensEnabled:!1,lensChannel:0,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1,isRGB:!1,shapeIsInterleaved:!1,pending:!1,globalDimensions:[],metadata:void 0,loader:[],error:void 0,lockChannels:!1}}var de=n(3433),pe=n(4506);function ve(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}var he=n(4925),me=["channels","colors","domains","contrastLimits"];function be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?be(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge=[],Oe=n(4477);function we(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function je(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?we(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):we(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Pe=[],Ce=[0,1];function ke(e,t){switch(t.type){case ne:return je(je({},e),{},{pending:!0,error:void 0});case re:return je(je({},e),{},{pending:!1});case ie:return function(e,t,n){var r=Object.entries(n||{}).filter((function(t){var n=(0,a.Z)(t,1)[0];return e&&e[n]&&Array.isArray(e[n])}));if(r.length>0){var o=function(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ve(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ve(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}({},e||{});return r.forEach((function(e){var n=(0,a.Z)(e,2),r=n[0],i=n[1],c=o[r];o[r]=(0,de.Z)(c),o[r][t]=i})),o}return e}(e,t.channel,t.properties);case ce:var n=t.colorMap,r=void 0===n?"":n;return e.useColorMap?je(je({},e),{},{colorMap:r}):e;case ae:var o=t.lensChannel,i=void 0===o?0:o,s=e.lensEnabled,l=e.useLens;return s&&l?je(je({},e),{},{lensChannel:i}):e;case se:var u=t.lensEnabled,f=void 0!==u&&u,d=e.lensEnabled,p=e.useLens;return je(je({},e),{},p&&!d&&f?{lensEnabled:f,lensChannel:0}:{lensEnabled:!1});case le:var v=t.position,h=void 0===v?{}:v,m=e.globalDimensions,b=void 0===m?[]:m,y=e.selections,g=void 0===y?[]:y,O=e.globalSelection,w=void 0===O?{}:O,j=function(e,t){var n=(b.find((function(t){return t.label===e}))||{}).size,r=void 0===n?0:n;return Math.max(0,Math.min(r,Math.round(t)))},P=Object.entries(h).filter((function(e){var t=(0,a.Z)(e,1)[0];return Oe.Z.includes(t)&&b.find((function(e){return e.label===t}))})).map((function(e){var t=(0,a.Z)(e,2),n=t[0],r=t[1];return{dimension:n,position:j(n,r)}}));if(P.length>0){var C=P.map((function(e){var t=e.dimension,n=e.position;return(0,c.Z)({},t,n)})).reduce((function(e,t){return je(je({},e),t)}),{}),k=je(je({},w),C),Z=g.map((function(e){return je(je({},e),C)}));return je(je({},e),{},{selections:Z,globalSelection:k})}return e;case ue:var S=t.lock,x=e.contrastLimits,D=void 0===x?Pe:x,E=e.realDomains,L=void 0===E?Pe:E,R=je(je({},e),{},{lockChannels:S});return S||(R.domains=L.slice(),R.contrastLimits=D.map((function(e,t){var n=L[t];if(n&&Array.isArray(n)&&2===n.length){var r=(0,pe.Z)(e),o=r[0],i=r[1],c=r.slice(2),s=(0,a.Z)(n,2),l=s[0],u=s[1],f=function(e){return Math.max(l,Math.min(u,e))};return[f(o),f(i)].concat((0,de.Z)(c))}return e}))),R;case te:var z=function(e,t){var n=e||{},r=n.lockChannels,o=void 0!==r&&r,i=n.channels,c=void 0===i?ge:i,a=n.colors,s=void 0===a?ge:a,l=n.domains,u=void 0===l?ge:l,f=n.contrastLimits,d=void 0===f?ge:f,p=n.channelsVisibility,v=void 0===p?ge:p,h=t||{},m=h.channels,b=void 0===m?ge:m,y=h.colors,g=void 0===y?ge:y,O=h.domains,w=void 0===O?ge:O,j=h.contrastLimits,P=void 0===j?ge:j,C=(0,he.Z)(h,me);if(!o)return ye(ye({},C),{},{channels:b,colors:g,domains:w,contrastLimits:P,realDomains:w.slice(),channelsVisibility:b.map((function(){return!0}))});for(var k=c.slice(),Z=[],S=0;S<b.length;S+=1){var x=k.indexOf(b[S]);-1===x?Z.push({channel:b[S],color:g[S],domain:w[S],realDomain:w[S].slice(),contrastLimits:P[S],visibility:!0}):(k.splice(x,1,void 0),Z.push({channel:b[S],color:s[x]||g[S],domain:u[x]||w[S],realDomain:w[S].slice(),contrastLimits:d[x]||P[S],visibility:void 0===v[x]||v[x]}))}return ye(ye({},C),{},{channels:Z.map((function(e){return e.channel})),colors:Z.map((function(e){return e.color})),domains:Z.map((function(e){return e.domain})),realDomains:Z.map((function(e){return e.realDomain})),contrastLimits:Z.map((function(e){return e.contrastLimits})),channelsVisibility:Z.map((function(e){return e.visibility}))})}(e,t),M=z.channels,I=void 0===M?Pe:M,V=z.channelsVisibility,A=void 0===V?Pe:V,B=z.selections,H=void 0===B?Pe:B,T=z.colors,N=void 0===T?Pe:T,U=z.domains,F=void 0===U?Pe:U,G=z.realDomains,W=void 0===G?F.slice():G,$=z.contrastLimits,_=void 0===$?Pe:$,q=z.useLens,J=void 0!==q&&q,K=z.useColorMap,Q=void 0!==K&&K,X=z.colorMap,Y=void 0===X?Q?e.colorMap:"":X,ee=z.lensEnabled,fe=void 0!==ee&&ee,be=z.lensChannel,we=void 0===be?0:be,ke=z.xSlice,Ze=void 0===ke?Ce:ke,Se=z.ySlice,xe=void 0===Se?Ce:Se,De=z.zSlice,Ee=void 0===De?Ce:De,Le=z.use3D,Re=void 0!==Le&&Le,ze=z.ready,Me=void 0!==ze&&ze,Ie=z.isRGB,Ve=void 0!==Ie&&Ie,Ae=z.shapeIsInterleaved,Be=void 0!==Ae&&Ae,He=z.globalDimensions,Te=void 0===He?Pe:He,Ne=z.metadata,Ue=z.loader;return je(je({},e),{},{identifiers:I.map((function(e,t){return"".concat(e||"channel","-").concat(t)})),channels:I,channelsVisibility:A,selections:H,builtForSelections:H,globalSelection:(H||[])[0],pixelValues:new Array((H||[]).length).fill("-----"),colors:N,domains:F,realDomains:W,contrastLimits:_,useLens:J,useColorMap:Q,colorMap:Y,lensEnabled:fe,lensChannel:we,xSlice:Ze,ySlice:xe,zSlice:Ee,use3D:Re,ready:Me,isRGB:Ve,shapeIsInterleaved:Be,globalDimensions:Te,error:void 0,metadata:Ne,loader:Ue});case oe:var Fe=t.error;return je(je({},e),{},{error:Fe,pending:!1});default:return e}}var Ze=n(3467);function Se(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function xe(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Se(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Se(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function De(e,t){for(var n=[],r=xe(xe({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:Oe.Z;return e.labels.filter((function(e){return t.includes(e)})).map((function(e){return(0,c.Z)({},e,0)})).reduce((function(e,t){return xe(xe({},e),t)}),{})}(e)),t||{}),o=e.labels.map((function(t,n){return{name:t,size:e.shape[n]}})).find((function(e){return!Oe.Z.includes(e.name)&&e.size})),i=0;i<Math.min(4,o.size);i+=1)n.push(xe((0,c.Z)({},o.name,i),r));return P(e.shape)?[xe(xe({},n[0]),{},{c:0})]:n}function Ee(e){return Le.apply(this,arguments)}function Le(){return(Le=(0,b.Z)(g().mark((function e(t){var n,r,o,i,c,a,s;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=Array.isArray(n)?n[n.length-1]:n,e.next=4,o.getRaster({selection:r});case 4:return i=e.sent,c=(0,u.mx)(i.data),a=c.domain,s=c.contrastLimits,e.abrupt("return",{domain:a,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Re(e){return ze.apply(this,arguments)}function ze(){return(ze=(0,b.Z)(g().mark((function e(t){var n,r,o,i,c,a,s,l,f,d,p,v;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=n[n.length-1],i=o.shape,c=o.labels,a=i[c.indexOf("z")]>>n.length-1,e.next=6,o.getRaster({selection:xe(xe({},r),{},{z:0})});case 6:return s=e.sent,e.next=9,o.getRaster({selection:xe(xe({},r),{},{z:Math.floor(a/2)})});case 9:return l=e.sent,e.next=12,o.getRaster({selection:xe(xe({},r),{},{z:Math.max(0,a-1)})});case 12:return f=e.sent,d=(0,u.mx)(s.data),p=(0,u.mx)(l.data),v=(0,u.mx)(f.data),e.abrupt("return",{domain:[Math.min(d.domain[0],p.domain[0],v.domain[0]),Math.max(d.domain[1],p.domain[1],v.domain[1])],contrastLimits:[Math.min(d.contrastLimits[0],p.contrastLimits[0],v.contrastLimits[0]),Math.max(d.contrastLimits[1],p.contrastLimits[1],v.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Me(e){return Ie.apply(this,arguments)}function Ie(){return(Ie=(0,b.Z)(g().mark((function e(t){var n,r,o,i;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=t.use3d,i=o?Re:Ee,e.abrupt("return",i({loader:n,selection:r}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ve(e){return Ae.apply(this,arguments)}function Ae(){return(Ae=(0,b.Z)(g().mark((function e(t){var n,r,o,i,c,a;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selections,o=t.use3d,e.next=3,Promise.all(r.map((function(e){return Me({loader:n,selection:e,use3d:o})})));case 3:return i=e.sent,c=i.map((function(e){return e.domain})),a=i.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:c,contrastLimits:a});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Be(e){var t=Array.isArray(e)?e[0]:e,n=t.shape,r=t.labels,o=function(e){var t,n,r=null!==(t=null==e||null===(n=e.meta)||void 0===n?void 0:n.physicalSizes)&&void 0!==t?t:{},o=r.x,i=r.y,c=r.z;if(null!=o&&o.size&&null!=i&&i.size&&null!=c&&c.size){var a=Math.min(c.size,o.size,i.size),s=[o.size/a,i.size/a,c.size/a];return(new Ze.Z).scale(s)}return(new Ze.Z).identity()}(t);return[[0,o[0]*n[r.indexOf("x")]],[0,o[5]*n[r.indexOf("y")]],[0,o[10]*n[r.indexOf("z")]]]}function He(e){var t=e.Pixels||{},n=t.Channels,r=void 0===n?[]:n,o=t.SizeC,i=void 0===o?0:o,c=t.Interleaved,a=void 0!==c&&c,s=t.Type,l=r.length,u=(r[0]||{}).SamplesPerPixel;return 3===(void 0===u?0:u)||3===l&&"uint8"===s||3===i&&1===l&&a}var Te=[255,0,0],Ne=[0,255,0],Ue=[0,0,255],Fe=[255,255,255],Ge=[Ue,Ne,[255,0,255],[255,255,0],[255,60,0],[154,0,255],Fe,Te],We=[0,255];function $e(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}function _e(e,t,n,r){return qe.apply(this,arguments)}function qe(){return(qe=(0,b.Z)(g().mark((function e(t,n,r,o){var i,c,s,l,u,f,d,p,v,h,m,b,y,O,w,j,C,k,Z,S,x,D;return g().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t[0]||{},c=i.shape,s=i.labels,l=(void 0===s?[]:s).map((function(e,t){return{label:e,size:c[t]||0}})).filter((function(e){return e.size>1&&Oe.Z.includes(e.label)})),u=r||De(t[0],o),f=n.Pixels,d=(void 0===f?{}:f).Channels,p=void 0===d?[]:d,v=[],h=[],m=[],b=!1,y=!1,O=He(n),w=O&&P(c),!O){e.next=18;break}P(c)?(v=[We.slice()],m=[We.slice()],h=[Te]):(v=[We.slice(),We.slice(),We.slice()],m=[We.slice(),We.slice(),We.slice()],h=[Te,Ne,Ue]),b=!1,y=!1,e.next=26;break;case 18:return e.next=20,Ve({loader:t,selections:u,use3d:!1});case 20:j=e.sent,m=j.domains.slice(),v=j.contrastLimits.slice(),h=1===j.domains.length?[Fe]:j.domains.map((function(e,t){return Ge[t]})),b=p.length>1,y=!0;case 26:return C=p.map($e),k=Be(t),Z=(0,a.Z)(k,3),S=Z[0],x=Z[1],D=Z[2],e.abrupt("return",{channels:C,selections:u,useLens:b,useColorMap:y,colors:h,domains:m,contrastLimits:v,xSlice:S,ySlice:x,zSlice:D,ready:!0,isRGB:O,shapeIsInterleaved:w,globalDimensions:l,metadata:n,loader:t});case 29:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Je(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ke(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Je(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Je(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Qe(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.selections,c=r.cache,a=r.imageTimePosition,s=void 0===a?0:a,l=r.imageZPosition,u=void 0===l?0:l,f=(0,o.useRef)(0);(0,o.useEffect)((function(){var r=e&&t&&e.Pixels&&t.length;if(r&&(i&&i!==c||!i)){n({type:ne}),f.current+=1;var o=f.current;_e(t,e,i,s||u?{t:s,z:u}:void 0).then((function(e){o===f.current&&n(Ke({type:te},e))})).catch((function(e){console.warn("HCS Image Viewer error: ".concat(e.message)),console.error(e),n({type:oe,error:e.message})}))}else r||n({type:te})}),[e,t,s,u,i,c,f,n])}function Xe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Ye(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Xe(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Xe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function et(){return{}}var tt=function(){var e=(0,o.useReducer)(q,{},et),t=(0,a.Z)(e,2),n=t[0],r=t[1];!function(e,t){var n=e||{},r=n.url,i=n.offsetsUrl,c=n.source;(0,o.useEffect)((function(){r&&(t({type:A}),function(){return ee.apply(this,arguments)}({url:r,offsetsUrl:i}).then((function(e){return t({type:B,source:e})})).catch((function(e){return t({type:H,error:e.message})})))}),[r,i,t])}(n,r);var i=function(e){var t=(0,o.useReducer)(ke,{},fe),n=(0,a.Z)(t,2),r=n[0],i=n[1],c=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.metadata,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),s=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.loader,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),l=e.imageTimePosition,u=void 0===l?0:l,f=e.imageZPosition,d=void 0===f?0:f,p=r.metadata,v=r.loader,h=r.selections,m=r.builtForSelections;return Qe(c,s,i,(0,o.useMemo)((function(){return{imageTimePosition:u,imageZPosition:d}}),[u,d])),Qe(p,v,i,(0,o.useMemo)((function(){return{selections:h,cache:m}}),[h,m])),{state:r,dispatch:i}}(n),c=i.state,s=i.dispatch,l=(0,o.useCallback)((function(e,t,n){r({url:e,offsetsUrl:t,callback:n,type:V})}),[r]),u=(0,o.useCallback)((function(e){r(Ye({type:T},e))}),[r]),f=(0,o.useCallback)((function(e){r({type:T,mesh:e})}),[r]),d=(0,o.useCallback)((function(e){r(Ye({type:N},e)),s({type:re})}),[r,s]),p=(0,o.useCallback)((function(){s({type:ne})}),[s]),v=(0,o.useCallback)((function(e,t){s({type:ie,channel:e,properties:t})}),[s]),h=(0,o.useCallback)((function(e){s({type:ce,colorMap:e})}),[s]),m=(0,o.useCallback)((function(e){s({type:se,lensEnabled:e})}),[s]),b=(0,o.useCallback)((function(e){s({type:ae,lensChannel:e})}),[s]),y=(0,o.useCallback)((function(e){s({type:le,position:e})}),[s]),g=(0,o.useCallback)((function(e){s({type:ue,lock:e})}),[s]);return{callbacks:(0,o.useMemo)((function(){return{setData:l,setImage:u,setImageViewportLoading:p,setImageViewportLoaded:d,setChannelProperties:v,setColorMap:h,setLensEnabled:m,setLensChannel:b,setGlobalPosition:y,setLockChannels:g,setMesh:f}}),[l,u,p,d,v,h,m,b,y,g,f]),dispatch:r,state:n,viewerState:c,viewerDispatch:s}};function nt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Array.isArray(e)?e[0]:e,o=C(r);if(o&&t){var i=o.width,c=o.height;return Math.log2(Math.min(t.width/i,t.height/c))-n}return-1/0}function rt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ot(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?rt(Object(n),!0).forEach((function(t){(0,c.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):rt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var it=new u.$h,ct=new u.z6;function at(e){var t=e.className,n=e.onStateChange,r=e.onRegisterStateActions,i=e.onViewerStateChanged,c=e.style,s=e.minZoomBackOff,l=void 0===s?0:s,f=e.maxZoomBackOff,d=void 0===f?void 0:f,p=e.defaultZoomBackOff,v=void 0===p?0:p,h=e.overview,m=e.onCellClick,b=tt(),y=b.state,g=b.viewerState,O=b.callbacks,w=y.mesh,j=(0,o.useRef)(),P=function(e){var t=(0,o.useState)({width:void 0,height:void 0}),n=(0,a.Z)(t,2),r=n[0],i=n[1],c=(0,o.useRef)(void 0);return(0,o.useEffect)((function(){var t,n,r;return function o(){var a,s,l=null==e||null===(a=e.current)||void 0===a?void 0:a.clientWidth,u=null==e||null===(s=e.current)||void 0===s?void 0:s.clientHeight;e&&e.current&&(l!==t||u!==n)&&(i({width:t=l,height:n=u}),c.current={width:t,height:n}),r=requestAnimationFrame(o)}(),function(){return cancelAnimationFrame(r)}}),[e,i,c]),{size:r,sizeRef:c}}(j),C=P.sizeRef;(0,o.useEffect)((function(){n&&n(y)}),[y,n]),(0,o.useEffect)((function(){i&&i(g)}),[g,i]),(0,o.useEffect)((function(){r&&r(O)}),[O,r]);var k=O||{},Z=k.setImageViewportLoading,S=k.setImageViewportLoaded,x=g.channelsVisibility,D=void 0===x?[]:x,E=g.contrastLimits,L=void 0===E?[]:E,R=g.colors,z=void 0===R?[]:R,M=g.selections,V=void 0===M?[]:M,A=g.ready,B=void 0!==A&&A,H=g.colorMap,T=g.loader,N=g.useLens,U=g.lensEnabled,F=g.lensChannel;(0,o.useEffect)((function(){"function"==typeof Z&&Z()}),[V,T,Z]);var G=(0,o.useState)(void 0),W=(0,a.Z)(G,2),$=W[0],_=W[1];(0,o.useEffect)((function(){if(T&&T.length&&C.current&&C.current.width&&C.current.height){var e=Array.isArray(T)?T:[T],t=(0,a.Z)(e,1)[0],n=Array.isArray(T)?T[T.length-1]:T,r=[ot(ot({},(0,u.TI)(T,C.current,v)),{},{id:u.ys,minZoom:void 0!==l?nt(t,C.current,l):-1/0,maxZoom:void 0!==d?nt(n,C.current,d):1/0})];_(r)}else _(void 0)}),[T,C,_,l,d,v]);var q=T&&B&&C.current&&C.current.width&&C.current.height&&$;return o.createElement("div",{className:t,style:ot({position:"relative"},c||{}),ref:j},q&&o.createElement(I,{mesh:w,contrastLimits:L,colors:z,channelsVisible:D,loader:T,selections:V,height:C.current.height,width:C.current.width,extensions:H?[it]:[ct],colormap:H||"viridis",onViewportLoad:S,viewStates:$,overviewOn:!!h,overview:h,lensSelection:N&&U?F:void 0,lensEnabled:N&&U,onCellClick:m,deckProps:{glOptions:{preserveDrawingBuffer:!0}}}))}at.propTypes={className:l().string,onStateChange:l().func,onRegisterStateActions:l().func,onViewerStateChanged:l().func,style:l().object,minZoomBackOff:l().number,maxZoomBackOff:l().number,defaultZoomBackOff:l().number,overview:l().object,onCellClick:l().func},at.defaultProps={className:void 0,onStateChange:void 0,onRegisterStateActions:void 0,onViewerStateChanged:void 0,style:void 0,minZoomBackOff:0,maxZoomBackOff:void 0,defaultZoomBackOff:0,overview:void 0,onCellClick:void 0};var st=at;function lt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},c=n.onStateChange,a=n.onRegisterStateActions,s=n.onViewerStateChanged,l=n.onCellClick;i.render(o.createElement(st,(0,r.Z)({onRegisterStateActions:a,onStateChange:c,onViewerStateChanged:s,onCellClick:l},t)),e)}},802:function(){},2195:function(){},1998:function(){},9521:function(){},9214:function(){},3752:function(){},3640:function(){},2630:function(){}}]);