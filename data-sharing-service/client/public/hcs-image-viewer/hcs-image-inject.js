"use strict";(self.webpackChunkHcsImageViewer=self.webpackChunkHcsImageViewer||[]).push([[822],{3404:function(e,t,n){n.r(t),n.d(t,{default:function(){return _t}});var r=n(7462),o=n(7294),i=n(3935),a=n(4942),c=n(9439),s=n(5697),l=n.n(s),u=n(4035),f=n(1002),p=n(5671),d=n(3144),v=n(1752),h=n(136),y=n(3930),m=n(1120),g=n(5861),b=n(4687),O=n.n(b),w=n(4088),j=n(8918),C=n(3121);function P(e){var t=e[e.length-1];return 3===t||4===t}function k(e){if(e&&e.shape){var t=P(e.shape),n=e.shape.slice(t?-3:-2),r=(0,c.Z)(n,2);return{height:r[0],width:r[1]}}}var Z,S={x:-1,y:-1},A=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=e.mesh,o=void 0===r?{}:r,i=e.hoveredCell,a=o.cells,c=void 0===a?[]:a,s=o.selected,l=void 0===s?[]:s,u=o.meshSize,f=void 0===u?1:u,p=o.notSelectedAlpha,d=void 0===p?.75:p,v=k(t[0])||{},h=v.width,y=void 0===h?0:h,m=v.height,g=y/f,b=(void 0===m?0:m)/f,O=function(e,t){return[e*g,t*b]},j=function(e,t){return[O(e,t),O(e+1,t),O(e+1,t+1),O(e,t+1)]},P=function(e){return e&&i&&i.id===e.id},Z=c.slice();Z.sort((function(e,t){return Number(P(e))-Number(P(t))}));var A=new C.Z({id:"line-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:Z,getPolygon:function(e){return j(e.x,e.y)},getLineWidth:function(e){return P(e)?2:1},lineWidthUnits:"pixels",getLineColor:function(e){return P(e)?[220,220,220]:[220,220,220,50]},filled:!1,stroked:!0,updateTriggers:{getLineColor:[i||S]}}),x=new C.Z({id:"cell-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:c,getPolygon:function(e){return j(e.x,e.y)},filled:!0,stroked:!1,pickable:!0,getFillColor:[255,255,255,0]});return[new C.Z({id:"cell-not-selected-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:c.filter((function(e){return e&&!l.some((function(t){return t.id===e.id}))})),getPolygon:function(e){return j(e.x,e.y)},filled:!0,stroked:!1,getFillColor:[0,0,0,Math.max(0,Math.min(255,Math.round(255*d)))]}),A,x]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t),!0}}]),o}(j.Z);A.layerName="CollageMeshLayer",A.defaultProps={loader:{type:"object",value:{getRaster:(Z=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)}))),function(){return Z.apply(this,arguments)}),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"collage-mesh-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{meshSize:0},compare:!0},onHover:{type:"function",value:function(){},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var x=A,E=n(5395),D=n(3693);function R(e){if(!e)return[1,1,1,1];if("object"===(0,f.Z)(e)&&Array.isArray(e)){var t=(0,c.Z)(e,4),n=t[0],r=void 0===n?1:n,o=t[1],i=void 0===o?1:o,a=t[2],s=void 0===a?1:a,l=t[3];return[r,i,s,void 0===l?1:l]}if("string"==typeof e&&/^#/i.test(e)){var u=function(e){return parseInt(e||"FF",16)/255};return[u(e.slice(1,3)),u(e.slice(3,5)),u(e.slice(5,7)),u(e.slice(7,9))]}if("number"==typeof e){var p=function(e){return Math.max(0,Math.min(1,e))};return[p(e),p(e),p(e),1]}return[1,1,1,1]}function L(e){var t=R(e),n=(0,c.Z)(t,4),r=n[0],o=n[1],i=n[2],a=n[3];return[255*r,255*o,255*i,255*(void 0===a?1:a)]}function M(e){var t=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}();return function(){var n,r=(0,m.Z)(e);if(t){var o=(0,m.Z)(this).constructor;n=Reflect.construct(r,arguments,o)}else n=r.apply(this,arguments);return(0,y.Z)(this,n)}}var I=function(e){(0,h.Z)(n,e);var t=M(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"getShaders",value:function(){return{inject:{"fs:#decl":"uniform float accuracy;","fs:DECKGL_FILTER_COLOR":"\n          if (color.r < accuracy && color.g < accuracy && color.b < accuracy) {\n            // is transparent\n            color = vec4(0.0, 0.0, 0.0, 0.0);\n          }\n        "}}}},{key:"updateState",value:function(e){for(var t=e.props.ignoreColorAccuracy,n=void 0===t?.1:t,r=this.getModels(),o=0;o<r.length;o+=1)r[o].setUniforms({accuracy:n})}}]),n}(D.Z),z=function(e){(0,h.Z)(n,e);var t=M(n);function n(){return(0,p.Z)(this,n),t.apply(this,arguments)}return(0,d.Z)(n,[{key:"getShaders",value:function(){return{inject:{"fs:#decl":"uniform float accuracy; uniform vec4 tint;","fs:DECKGL_FILTER_COLOR":"\n          if (color.r < accuracy && color.g < accuracy && color.b < accuracy) {\n            // is transparent\n            color = vec4(0.0, 0.0, 0.0, 0.0);\n          } else {\n            color = tint;\n          }\n        "}}}},{key:"updateState",value:function(e){for(var t=e.props,n=t.ignoreColorAccuracy,r=void 0===n?.1:n,o=t.color,i=void 0===o?[1,1,1,1]:o,a=this.getModels(),c=0;c<a.length;c+=1)a[c].setUniforms({accuracy:r,tint:R(i)})}}]),n}(D.Z);var B=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=e.url,o=e.color,i=e.ignoreColor,a=e.ignoreColorAccuracy,c=k(t[0])||{},s=c.width,l=void 0===s?0:s,u=c.height,f=void 0===u?0:u;return[new E.Z({id:"image-layer-".concat(n),image:r,bounds:[0,f,l,0],ignoreColorAccuracy:a,color:o,extensions:[!(!i||o)&&new I,!(!i||!o)&&new z].filter(Boolean)})]}}]),o}(j.Z);B.layerName="ImageOverlayLayer",B.defaultProps={loader:{type:"object",value:{getRaster:function(){var e=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"image-overlay-layer",compare:!0},url:{type:"string",value:void 0,compare:!0},color:{type:"string",value:void 0,compare:!0},ignoreColor:{type:"boolean",value:!1,compare:!0},ignoreColorAccuracy:{type:"number",value:.1,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},mesh:{type:"object",value:{rows:0,columns:0},compare:!0},onHover:{type:"function",value:function(){},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var T=B;function V(e){return"-#".concat(e,"#")}var N=n(2112);function H(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:1,n=e||[],r=(0,c.Z)(n,4),o=r[0],i=void 0===o?255:o,a=r[1],s=void 0===a?255:a,l=r[2],u=void 0===l?255:l,f=r[3],p=void 0===f?255:f;return[i,s,u,Math.max(0,Math.min(255,p*t))]}function F(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:function(e){return e.lineColor},r=t&&t!==e.identifier;return H(L(n(e)||[220,220,220]),r?.25:1)}var U=n(3433);function W(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function $(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?W(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):W(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var G=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"visibleAnnotations",get:function(){var e=this.props.annotations,t=(void 0===e?[]:e).filter((function(e){return void 0===e.visible||e.visible})).slice(),n=this.state.dragInfo;if(n&&n.object){var r=t.findIndex((function(e){return e.identifier===n.object.identifier}));r>=0&&t.splice(r,1,n.object)}return t}},{key:"moveObject",value:function(e,t){return e.center?$($({},e),{},{center:[e.center[0]+t[0],e.center[1]+t[1]]}):e.points?$($({},e),{},{points:e.points.map((function(e){return[e[0]+t[0],e[1]+t[1]]}))}):$({},e)}},{key:"getObjectCenter",value:function(e){if(e.center)return e.center.slice();if(e.points&&e.points.length>0){var t=e.points.map((function(e){return e[0]})),n=e.points.map((function(e){return e[1]}));return[(Math.min.apply(Math,(0,U.Z)(t))+Math.max.apply(Math,(0,U.Z)(t)))/2,(Math.min.apply(Math,(0,U.Z)(n))+Math.max.apply(Math,(0,U.Z)(n)))/2]}return[0,0]}},{key:"resizeObject",value:function(e,t,n){var r=this.getObjectCenter(e),o=[t[0]-r[0],t[1]-r[1]],i=[o[0]+n[0],o[1]+n[1]],a=function(e){return 0===o[e]?1:i[e]/o[e]},c=[a(0),a(1)],s=e.width,l=e.height,u=e.radius,f=e.points;void 0!==s&&(s*=c[0]),void 0!==l&&(l*=c[1]),void 0!==u&&(u*=Math.max(c[0],c[1])),void 0!==f&&f.length>0&&(f=f.map((function(e){return[r[0]+(e[0]-r[0])*c[0],r[1]+(e[1]-r[1])*c[1]]})));var p=$($({},e),{},{width:s?Math.abs(s):s,height:l?Math.abs(l):l,radius:u?Math.abs(u):u,points:f});return void 0===s&&delete p.width,void 0===l&&delete p.height,void 0===u&&delete p.radius,void 0===f&&delete p.points,p}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return"function"==typeof n&&t&&n(t.selectable?t.identifier:void 0),!0}},{key:"onDragStart",value:function(e,t){var n=e.object,r=e.coordinate;return!(!n.identifier||!n.editable||n.identifier!==this.props.selectedAnnotation||(this.setState({dragInfo:{object:$({},n),coordinate:r,resize:t.srcEvent&&t.srcEvent.shiftKey}}),t.stopPropagation(),0))}},{key:"onDrag",value:function(e,t){var n=e.object,r=e.coordinate,o=this.state.dragInfo;if(n&&o&&r&&o.object&&o.object.identifier===n.identifier&&o.coordinate){var i=[r[0]-o.coordinate[0],r[1]-o.coordinate[1]];return this.setState({dragInfo:$($({},o),{},{object:o.resize?this.resizeObject(n,o.coordinate,i):this.moveObject(n,i)})}),t.stopPropagation(),!0}return!1}},{key:"onDragEnd",value:function(e,t){var n=this.state.dragInfo;if(n){var r=this.props.onEdit;return"function"==typeof r&&n.object&&r(n.object),this.setState({dragInfo:void 0}),t.stopPropagation(),!0}return!1}}]),o}(j.Z);G.layerName="BaseAnnotationLayer",G.defaultProps={id:{type:"string",value:"base-annotation-layer",compare:!0},annotations:{type:"array",value:[],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0},onEdit:{type:"function",value:function(){},compare:!0}};var _=G;function q(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function K(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?q(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):q(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Q=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=function(e){var t=(0,c.Z)(e,2),n=t[0],r=void 0===n?0:n,o=t[1];return[r,void 0===o?0:o]},i={coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPath:function(t){var n,r,i,a,s,l,u,f,p=(0,c.Z)(t.points,2),d=p[0],v=p[1],h=t.pixels?e.unproject(d):d,y=t.pixels?e.unproject(v):v,m=Math.sqrt(Math.pow(h[0]-y[0],2)+Math.pow(h[1]-y[1],2)),g=Math.min(m,(10,n=e.unproject([0,0]),i=(r=(0,c.Z)(n,2))[0],a=r[1],s=e.unproject([10,0]),u=(l=(0,c.Z)(s,2))[0],f=l[1],Math.sqrt(Math.pow(i-u,2)+Math.pow(a-f,2)))),b=[y[0]-h[0],y[1]-h[1]],O=[-b[1],b[0]],w=function(e){var t=function(e){return Math.sqrt(Math.pow(e[0],2)+Math.pow(e[1],2))}(e);return 0===t?[0,0]:[e[0]/t,e[1]/t]},j=w(b),C=w(O),P=[y[0]-j[0]*g,y[1]-j[1]*g],k=[P[0]+C[0]*(g/2),P[1]+C[1]*(g/2)];return[h,P,[P[0]-C[0]*(g/2),P[1]-C[1]*(g/2)],y,k,P].map(o)}},a=new N.Z(K(K({id:"arrows-".concat(n)},i),{},{getWidth:function(){return 2},widthUnits:"pixels",getColor:function(e){return F(e,r)},filled:!1,stroked:!0,pickable:!1,updateTriggers:{getColor:[r]}}));return[a,new N.Z(K(K({id:"arrows-selectable-".concat(n)},i),{},{getWidth:function(){return 6},widthUnits:"pixels",getColor:function(){return[0,0,0,0]},filled:!1,stroked:!0,pickable:!0,updateTriggers:{getColor:[r]}}))]}}]),o}(_);Q.layerName="ArrowAnnotationLayer",Q.defaultProps={id:{type:"string",value:"arrow-annotation-layer",compare:!0},annotations:{type:"array",value:[{points:[[0,0],[0,0]],pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var J=Q;var X=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation;return[new C.Z({id:"rectangle-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPolygon:function(t){var n=function(e,n){return[t.center[0]+e*(t.width/2),t.center[1]+n*(t.height/2)]},r=function(n){return function(e){var t=(0,c.Z)(e,2),n=t[0],r=void 0===n?0:n,o=t[1];return[r,void 0===o?0:o]}(t.pixels?e.unproject(n):n)};return[r(n(-1,-1)),r(n(-1,1)),r(n(1,1)),r(n(1,-1))]},getLineWidth:function(){return 2},lineWidthUnits:"pixels",getLineColor:function(e){return F(e,r)},getFillColor:function(){return[0,0,0,0]},filled:!0,stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}})]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(_);X.layerName="RectangleAnnotationLayer",X.defaultProps={id:{type:"string",value:"rectangle-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],width:0,height:0,pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0},onEdit:{type:"function",value:function(){},compare:!0}};var Y=X,ee=n(8569);var te=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=new ee.Z({id:"circles-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPosition:function(t){return n=t.pixels?e.unproject(t.center):t.center,[void 0===(o=(r=(0,c.Z)(n,2))[0])?0:o,void 0===(i=r[1])?0:i];var n,r,o,i},getRadius:function(t){return t.pixels?(n=t.radius,r=e.unproject([0,0]),i=(o=(0,c.Z)(r,2))[0],a=o[1],s=e.unproject([n,0]),u=(l=(0,c.Z)(s,2))[0],f=l[1],Math.sqrt(Math.pow(i-u,2)+Math.pow(a-f,2))):t.radius;var n,r,o,i,a,s,l,u,f},getLineWidth:function(){return 2},lineWidthUnits:"pixels",getLineColor:function(e){return F(e,r)},filled:!0,getFillColor:[255,255,255,0],stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}});return[o]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(_);te.layerName="CircleAnnotationLayer",te.defaultProps={id:{type:"string",value:"circle-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],radius:0,pixels:!1,visible:!0,lineColor:[0,0,0]}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0},onEdit:{type:"function",value:function(){},compare:!0}};var ne=te,re=n(4506);function oe(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ie(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?oe(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):oe(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ae=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o={coordinateSystem:w.Df.CARTESIAN,data:this.visibleAnnotations,getPath:function(t){var n=function(n){return r=t.pixels?e.unproject(n):n,[void 0===(i=(o=(0,c.Z)(r,2))[0])?0:i,void 0===(a=o[1])?0:a];var r,o,i,a},r=(0,re.Z)(t.points),o=r[0],i=r.slice(1);return t.closed?[o].concat((0,U.Z)(i),[o]).map(n):[o].concat((0,U.Z)(i)).map(n)},getWidth:function(){return 2},widthUnits:"pixels",getColor:function(e){return F(e,r)},filled:!1,stroked:!0,pickable:!1,updateTriggers:{getColor:[r]}};return[new N.Z(ie({id:"polylines-".concat(n)},o)),new N.Z(ie(ie({id:"polylines-pickable-".concat(n)},o),{},{getWidth:function(){return 6},getColor:function(){return[0,0,0,0]},pickable:!0}))]}}]),o}(_);ae.layerName="PolylineAnnotationLayer",ae.defaultProps={id:{type:"string",value:"polyline-annotation-layer",compare:!0},annotations:{type:"array",value:[{points:[[0,0]],pixels:!1,visible:!0,lineColor:[0,0,0],closed:!1}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0},onEdit:{type:"function",value:function(){},compare:!0}};var ce=ae;var se=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this.props,t=e.loader,n=e.id,r=k(t[0])||{},o=r.width,i=void 0===o?0:o,a=r.height,c=void 0===a?0:a,s=[{polygon:[[0,0],[i,0],[i,c],[0,c]]}];return[new C.Z({id:"annotation-background-layer-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:s,getLineWidth:function(){return 0},lineWidthUnits:"pixels",getLineColor:function(){return[0,0,0,0]},getFillColor:function(){return[0,0,0,0]},filled:!0,stroked:!1,pickable:!0})]}},{key:"onClick",value:function(){var e=this.props.onClick;return e&&e(void 0),!0}}]),o}(j.Z);se.layerName="AnnotationBackgroundLayer",se.defaultProps={loader:{type:"object",value:{getRaster:function(){var e=(0,g.Z)(O().mark((function e(){return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",{data:[],height:0,width:0});case 1:case"end":return e.stop()}}),e)})));return function(){return e.apply(this,arguments)}}(),getRasterSize:function(){return{height:0,width:0}},dtype:"<u2"},compare:!0},id:{type:"string",value:"annotation-background-layer",compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0}};var le=se,ue=n(1447);var fe=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(){return(0,p.Z)(this,o),r.apply(this,arguments)}return(0,d.Z)(o,[{key:"renderLayers",value:function(){var e=this,t=this.props,n=t.id,r=t.selectedAnnotation,o=this.visibleAnnotations.filter((function(e){return e.label&&e.label.value}));return[new ue.Z({id:"labels-".concat(n),coordinateSystem:w.Df.CARTESIAN,data:o,getPosition:function(t){return n=t.pixels?e.unproject(t.center):t.center,[void 0===(o=(r=(0,c.Z)(n,2))[0])?0:o,void 0===(i=r[1])?0:i];var n,r,o,i},getText:function(e){return e.label?e.label.value:void 0},getSize:function(e){return(e.label?e.label.fontSize:0)||16},getColor:function(e){return F(e,r,(function(e){return e.label?e.label.color:void 0}))},getTextAnchor:"middle",getAlignmentBaseline:"center",filled:!0,getFillColor:[255,255,255,0],stroked:!0,pickable:!0,updateTriggers:{getLineColor:[r]}})]}},{key:"onHover",value:function(e){var t=e.object,n=this.props.onHover;return n&&n(t),!0}},{key:"onClick",value:function(e){var t=e.object,n=this.props.onClick;return n&&n(t?t.identifier:void 0),!0}}]),o}(_);fe.layerName="TextAnnotationLayer",fe.defaultProps={id:{type:"string",value:"text-annotation-layer",compare:!0},annotations:{type:"array",value:[{center:[0,0],label:{color:"#FFFFFF",fontSize:16,value:""},visible:!0}],compare:!0},selectedAnnotation:{type:"string",value:void 0,compare:!0},pickable:{type:"boolean",value:!0,compare:!0},viewState:{type:"object",value:{zoom:0,target:[0,0,0]},compare:!0},onClick:{type:"function",value:function(){},compare:!0},onEdit:{type:"function",value:function(){},compare:!0}};var pe=fe;function de(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ve(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?de(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):de(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var he=function(e){(0,h.Z)(o,e);var t,n,r=(t=o,n=function(){if("undefined"==typeof Reflect||!Reflect.construct)return!1;if(Reflect.construct.sham)return!1;if("function"==typeof Proxy)return!0;try{return Boolean.prototype.valueOf.call(Reflect.construct(Boolean,[],(function(){}))),!0}catch(e){return!1}}(),function(){var e,r=(0,m.Z)(t);if(n){var o=(0,m.Z)(this).constructor;e=Reflect.construct(r,arguments,o)}else e=r.apply(this,arguments);return(0,y.Z)(this,e)});function o(e){var t;(0,p.Z)(this,o),t=r.call(this,e);var n=e.mesh,i=e.overlayImages,a=void 0===i?[]:i,c=e.annotations,s=void 0===c?[]:c,l=e.selectedAnnotation,u=e.onCellHover,f=e.hoveredCell,d=e.onCellClick,v=e.onEditAnnotation,h=e.onSelectAnnotation;return t.onCellHover=u,t.hoveredCell=f,t.onCellClick=d,t.mesh=n,t.overlayImages=a,t.annotations=s,t.selectedAnnotation=l,t.onSelectAnnotation=h,t.onEditAnnotation=v,t}return(0,d.Z)(o,[{key:"getLayers",value:function(e){var t=e.viewStates,n=e.props,r=(0,v.Z)((0,m.Z)(o.prototype),"getLayers",this).call(this,{viewStates:t,props:n}),i=n.loader,a=this.id,c=this.height,s=this.width,l=t[a];this.overlayImages&&this.overlayImages.forEach((function(e,t){var n,o,u,p;"string"==typeof e?(n=e,o=!0,u=.1):"object"===(0,f.Z)(e)&&e.url&&(n=e.url,o=!!(p=e.color)||!!e.ignoreColor,u=e.ignoreColorAccuracy||.1),n&&r.push(new T({loader:i,url:n,color:p,ignoreColor:o,ignoreColorAccuracy:u,id:"image-".concat(t,"-").concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s})}))})),this.mesh&&r.push(new x(ve(ve({},n),{},{loader:i,id:"mesh-".concat(V(a)),mesh:ve({},this.mesh),viewState:ve(ve({},l),{},{height:c,width:s}),onHover:this.onCellHover,onClick:this.onCellClick,hoveredCell:this.hoveredCell})));var u=this.annotations.filter((function(e){return/^rectangle$/i.test(e.type)})),p=this.annotations.filter((function(e){return/^circle$/i.test(e.type)})),d=this.annotations.filter((function(e){return/^polyline$/i.test(e.type)})),h=this.annotations.filter((function(e){return/^arrow$/i.test(e.type)})),y=this.annotations.filter((function(e){return/^text$/i.test(e.type)}));return this.annotations.length>0&&r.push(new le(ve(ve({},this.props),{},{loader:i,id:"annotations-background-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),u.length>0&&r.push(new Y(ve(ve({},this.props),{},{id:"rectangle-annotation-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),annotations:u,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),p.length>0&&r.push(new ne(ve(ve({},this.props),{},{id:"circle-annotation-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),annotations:p,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),d.length>0&&r.push(new ce(ve(ve({},this.props),{},{id:"polyline-annotation-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),annotations:d,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),h.length>0&&r.push(new J(ve(ve({},this.props),{},{id:"arrow-annotation-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),annotations:h,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),y.length>0&&r.push(new pe(ve(ve({},this.props),{},{id:"text-annotation-".concat(V(a)),viewState:ve(ve({},l),{},{height:c,width:s}),annotations:y,selectedAnnotation:this.selectedAnnotation,onClick:this.onSelectAnnotation,onEdit:this.onEditAnnotation}))),r}}]),o}(u.O6);function ye(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ye(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ye(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ge={handleValue:function(){},handleCoordinate:function(){}},be=[],Oe=[255,255,255],we=[],je=function(e){var t=e.loader,n=e.contrastLimits,r=e.colors,i=e.channelsVisible,a=e.viewStates,s=void 0===a?be:a,l=e.colormap,f=e.overview,p=e.overviewOn,d=e.selections,v=e.hoverHooks,h=void 0===v?ge:v,y=e.height,m=e.width,g=e.lensEnabled,b=void 0!==g&&g,O=e.lensSelection,w=void 0===O?0:O,j=e.lensRadius,C=void 0===j?100:j,P=e.lensBorderColor,k=void 0===P?Oe:P,Z=e.lensBorderRadius,S=void 0===Z?.02:Z,A=e.clickCenter,x=void 0===A||A,E=e.transparentColor,D=e.onViewStateChange,R=e.onHover,L=e.onViewportLoad,M=e.extensions,I=void 0===M?we:M,z=e.deckProps,B=e.mesh,T=e.onCellClick,V=e.overlayImages,N=e.annotations,H=e.selectedAnnotation,F=e.onEditAnnotation,U=e.onSelectAnnotation,W=null==s?void 0:s.find((function(e){return e.id===u.ys})),$=(0,o.useMemo)((function(){return W||(0,u.TI)(t,{height:y,width:m},.5)}),[t,W]),G=(0,o.useState)(void 0),_=(0,c.Z)(G,2),q=_[0],K=_[1],Q=(0,o.useCallback)((function(e){e&&!q?K(e):e?e&&q&&e.column!==q.column&&e.row!==q.row&&K(e):K(e)}),[q,K]),J=new he({id:u.ys,height:y,width:m,mesh:B,onCellHover:Q,hoveredCell:q,onCellClick:T,onEditAnnotation:F,overlayImages:V,annotations:N,selectedAnnotation:H,onSelectAnnotation:U}),X={loader:t,contrastLimits:n,colors:r,channelsVisible:i,selections:d,onViewportLoad:L,colormap:l,lensEnabled:b,lensSelection:w,lensRadius:C,lensBorderColor:k,lensBorderRadius:S,extensions:I,transparentColor:E},Y=[],ee=[],te=[];if(Y.push(J),ee.push(X),te.push(me(me({},$),{},{id:u.ys})),p&&t){var ne=(null==s?void 0:s.find((function(e){return e.id===u.cl})))||me(me({},$),{},{id:u.cl}),re=new u.A6(me({id:u.cl,loader:t,detailHeight:y,detailWidth:m,clickCenter:x},f));Y.push(re),ee.push(me(me({},X),{},{lensEnabled:!1})),te.push(ne)}return t?o.createElement(u.iP,{layerProps:ee,views:Y,viewStates:te,hoverHooks:h,onViewStateChange:D,onHover:R,deckProps:z}):null},Ce="set-data",Pe="set-source-initializing",ke="set-source",Ze="set-source-error",Se="set-image",Ae="set-image-viewport-loaded",xe="set-mesh",Ee="set-overlay-images",De="set-annotations",Re="set-selected-annotation";function Le(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Me(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Le(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Le(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Ie(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ze(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Ie(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Ie(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Be(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Te(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Be(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Be(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Ve=function(e,t){switch(t.type){case Ce:return function(e,t){var n=t.url,r=t.offsetsUrl,o=t.callback,i=e.url,a=e.offsetsUrl;return i===n&&r===a?(o&&o(),e):Me(Me({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,imageTimePosition:0,imageZPosition:0,mesh:void 0,source:void 0,sourcePending:!1,sourceError:!1,sourceCallback:o,error:void 0,url:n,offsetsUrl:r})}(e,t);case"set-error":return function(e,t){var n=t.error;return ze(ze({},e),{},{error:n})}(e,t);case Pe:return function(e){return Te(Te({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:void 0,sourcePending:!0,imagePending:!1,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e);case Ze:return function(e,t){var n=t.error,r=e.sourceCallback;return"function"==typeof r&&setTimeout((function(){r({error:n})}),0),Te(Te({},e),{},{loader:void 0,metadata:void 0,imageIndex:0,source:void 0,sourceError:n,sourcePending:!1,sourceCallback:void 0,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e,t);case ke:return function(e,t){var n=t.source,r=e.sourceCallback;"function"==typeof r&&setTimeout((function(){r()}),0);var o=Array.isArray(n)?n:[n],i=o.map((function(e){return e.data})),a=o.map((function(e){return e.metadata}));return Te(Te({},e),{},{loader:i,metadata:a,imageIndex:0,source:n,sourceError:void 0,sourcePending:!1,sourceCallback:void 0,overlayImages:[],annotations:[],selectedAnnotation:void 0})}(e,t);case Se:return function(e,t){var n,r=t.index,o=t.ID,i=t.Name,a=t.search,s=t.imageTimePosition,l=void 0===s?0:s,u=t.imageZPosition,f=void 0===u?0:u,p=t.mesh,d=t.overlayImages,v=void 0===d?[]:d,h=t.annotations,y=void 0===h?[]:h,m=t.selectedAnnotation,g=void 0===m?void 0:m,b=e.metadata,O=void 0===b?[]:b,w=e.imageIndex;if(null!=r)n=O[r];else if(void 0!==o)n=O.find((function(e){return e.ID===o}));else if(void 0!==i)n=O.find((function(e){return(e.Name||e.name||"").toLowerCase()===i.toLowerCase()}));else if(a&&/^[\d]+_[\d]+$/.test(a)){var j=/^([\d]+)_([\d])+$/.exec(a),C=(0,c.Z)(j,3),P=C[1],k=C[2],Z=new RegExp("^\\s*well\\s+".concat(P,"\\s*,\\s*field\\s+").concat(k,"\\s*$"),"i");n=O.find((function(e){return Z.test(e.Name||e.name)}))}if(n){var S=O.indexOf(n);return Te(Te({},e),{},{imageIndex:S,imagePending:w!==S,imageTimePosition:l,imageZPosition:f,mesh:p,overlayImages:v,annotations:y,selectedAnnotation:g})}return e}(e,t);case Ae:return function(e){return e.imagePending?Te(Te({},e),{},{imagePending:!1}):e}(e);case xe:return function(e,t){var n=t.mesh;return Te(Te({},e),{},{mesh:n})}(e,t);case Ee:return function(e,t){var n=t.overlayImages,r=void 0===n?[]:n;return Te(Te({},e),{},{overlayImages:r})}(e,t);case De:return function(e,t){var n=t.annotations,r=void 0===n?[]:n,o=e.selectedAnnotation,i=r.find((function(e){return e.identifier===o}));return Te(Te({},e),{},{annotations:r,selectedAnnotation:i?i.identifier:void 0})}(e,t);case Re:return function(e,t){var n=t.selectedAnnotation;return Te(Te({},e),{},{selectedAnnotation:n})}(e,t);default:return e}},Ne=n(2162),He="set-default",Fe="set-loading",Ue="set-loaded",We="set-error",$e="set-channel-properties",Ge="set-default-channels-colors",_e="set-color-map",qe="set-lens-channel",Ke="set-lens-enabled",Qe="set-global-position",Je="set-lock-channels";function Xe(){var e=[];return{identifiers:[],channels:[],channelsVisibility:[],selections:e,builtForSelections:e,globalSelection:void 0,colors:[],domains:[],realDomains:[],contrastLimits:[],useLens:!1,useColorMap:!1,colorMap:"",lensEnabled:!1,lensChannel:0,use3D:!1,pixelValues:[],xSlice:[0,1],ySlice:[0,1],zSlice:[0,1],ready:!1,isRGB:!1,shapeIsInterleaved:!1,pending:!1,globalDimensions:[],metadata:void 0,loader:[],error:void 0,lockChannels:!1}}var Ye=n(5702);function et(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function tt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?et(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):et(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var nt=n(4925),rt=["channels","colors","domains","contrastLimits"];function ot(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function it(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?ot(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ot(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var at=[],ct=n(4477);function st(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function lt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?st(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):st(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var ut=[],ft=[0,1];function pt(e,t){switch(t.type){case Fe:return lt(lt({},e),{},{pending:!0,error:void 0});case Ue:return lt(lt({},e),{},{pending:!1});case $e:return function(e,t,n){var r=Object.entries(n||{}).filter((function(t){var n=(0,c.Z)(t,1)[0];return e&&e[n]&&Array.isArray(e[n])}));if(r.length>0){var o=tt({},e||{}),i=e.channels,a=(void 0===i?[]:i)[t];return r.forEach((function(e){var n=(0,c.Z)(e,2),r=n[0],i=n[1],s=o[r];o[r]=(0,U.Z)(s),o[r][t]=i,"colors"===r&&a&&Ye.bA.updateChannelColor(a,i)})),o}return e}(e,t.channel,t.properties);case Ge:return function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=e||{},r=n.channels,o=void 0===r?[]:r,i=n.colors,a=(void 0===i?[]:i).slice();return Object.entries(t).forEach((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1],i=o.findIndex((function(e){return e===n}));i>=0&&(a[i]=r)})),Ye.bA.update(t),tt(tt({},e),{},{colors:a})}(e,t.defaultColors);case _e:var n=t.colorMap,r=void 0===n?"":n;return e.useColorMap?lt(lt({},e),{},{colorMap:r}):e;case qe:var o=t.lensChannel,i=void 0===o?0:o,s=e.lensEnabled,l=e.useLens;return s&&l?lt(lt({},e),{},{lensChannel:i}):e;case Ke:var u=t.lensEnabled,f=void 0!==u&&u,p=e.lensEnabled,d=e.useLens;return lt(lt({},e),{},d&&!p&&f?{lensEnabled:f,lensChannel:0}:{lensEnabled:!1});case Qe:var v=t.position,h=void 0===v?{}:v,y=e.globalDimensions,m=void 0===y?[]:y,g=e.selections,b=void 0===g?[]:g,O=e.globalSelection,w=void 0===O?{}:O,j=function(e,t){var n=(m.find((function(t){return t.label===e}))||{}).size,r=void 0===n?0:n;return Math.max(0,Math.min(r,Math.round(t)))},C=Object.entries(h).filter((function(e){var t=(0,c.Z)(e,1)[0];return ct.Z.includes(t)&&m.find((function(e){return e.label===t}))})).map((function(e){var t=(0,c.Z)(e,2),n=t[0],r=t[1];return{dimension:n,position:j(n,r)}}));if(C.length>0){var P=C.map((function(e){var t=e.dimension,n=e.position;return(0,a.Z)({},t,n)})).reduce((function(e,t){return lt(lt({},e),t)}),{}),k=lt(lt({},w),P),Z=b.map((function(e){return lt(lt({},e),P)}));return lt(lt({},e),{},{selections:Z,globalSelection:k})}return e;case Je:var S=t.lock,A=e.channels,x=void 0===A?ut:A,E=e.contrastLimits,D=void 0===E?ut:E,R=e.realDomains,L=void 0===R?ut:R,M=lt(lt({},e),{},{lockChannels:S}),I=Array.isArray(S)?S.slice():S?x.slice():[];return M.domains=(M.domains||[]).map((function(e,t){return I.includes(x[t])?e:L[t]||e})),M.contrastLimits=D.map((function(e,t){if(I.includes(x[t]))return e;var n=M.domains[t];if(n&&Array.isArray(n)&&2===n.length){var r=(0,re.Z)(e),o=r[0],i=r[1],a=r.slice(2),s=(0,c.Z)(n,2),l=s[0],u=s[1],f=function(e){return Math.max(l,Math.min(u,e))};return[f(o),f(i)].concat((0,U.Z)(a))}return e})),M;case He:var z=function(e,t){var n=e||{},r=n.lockChannels,o=void 0!==r&&r,i=n.channels,a=void 0===i?at:i,c=n.colors,s=void 0===c?at:c,l=n.domains,u=void 0===l?at:l,f=n.contrastLimits,p=void 0===f?at:f,d=n.channelsVisibility,v=void 0===d?at:d,h=t||{},y=h.channels,m=void 0===y?at:y,g=h.colors,b=void 0===g?at:g,O=h.domains,w=void 0===O?at:O,j=h.contrastLimits,C=void 0===j?at:j,P=(0,nt.Z)(h,rt);if(!o||Array.isArray(o)&&0===o.length)return it(it({},P),{},{channels:m,colors:b,domains:w,contrastLimits:C,realDomains:w.slice(),channelsVisibility:m.map((function(){return!0}))});if(0===m.length)return e;for(var k=Array.isArray(o)?o:m.slice(),Z=a.slice(),S=[],A=0;A<m.length;A+=1){var x=Z.indexOf(m[A]);k.includes(m[A])&&-1!==x?(Z.splice(x,1,void 0),S.push({channel:m[A],color:s[x]||b[A],domain:u[x]||w[A],realDomain:w[A].slice(),contrastLimits:p[x]||C[A],visibility:void 0===v[x]||v[x]})):S.push({channel:m[A],color:b[A],domain:w[A],realDomain:w[A].slice(),contrastLimits:C[A],visibility:!0})}return it(it({},P),{},{channels:S.map((function(e){return e.channel})),colors:S.map((function(e){return e.color})),domains:S.map((function(e){return e.domain})),realDomains:S.map((function(e){return e.realDomain})),contrastLimits:S.map((function(e){return e.contrastLimits})),channelsVisibility:S.map((function(e){return e.visibility}))})}(e,t),B=z.channels,T=void 0===B?ut:B,V=z.channelsVisibility,N=void 0===V?ut:V,H=z.selections,F=void 0===H?ut:H,W=z.colors,$=void 0===W?ut:W,G=z.domains,_=void 0===G?ut:G,q=z.realDomains,K=void 0===q?_.slice():q,Q=z.contrastLimits,J=void 0===Q?ut:Q,X=z.useLens,Y=void 0!==X&&X,ee=z.useColorMap,te=void 0!==ee&&ee,ne=z.colorMap,oe=void 0===ne?te?e.colorMap:"":ne,ie=z.lensEnabled,ae=void 0!==ie&&ie,ce=z.lensChannel,se=void 0===ce?0:ce,le=z.xSlice,ue=void 0===le?ft:le,fe=z.ySlice,pe=void 0===fe?ft:fe,de=z.zSlice,ve=void 0===de?ft:de,he=z.use3D,ye=void 0!==he&&he,me=z.ready,ge=void 0!==me&&me,be=z.isRGB,Oe=void 0!==be&&be,we=z.shapeIsInterleaved,je=void 0!==we&&we,Ce=z.globalDimensions,Pe=void 0===Ce?ut:Ce,ke=z.metadata,Ze=z.loader;return lt(lt({},e),{},{identifiers:T.map((function(e,t){return"".concat(e||"channel","-").concat(t)})),channels:T,channelsVisibility:N,selections:F,builtForSelections:F,globalSelection:(F||[])[0],pixelValues:new Array((F||[]).length).fill("-----"),colors:$,domains:_,realDomains:K,contrastLimits:J,useLens:Y,useColorMap:te,colorMap:oe,lensEnabled:ae,lensChannel:se,xSlice:ue,ySlice:pe,zSlice:ve,use3D:ye,ready:ge,isRGB:Oe,shapeIsInterleaved:je,globalDimensions:Pe,error:void 0,metadata:ke,loader:Ze});case We:var Se=t.error;return lt(lt({},e),{},{error:Se,pending:!1});default:return e}}var dt=n(5451);function vt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function ht(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?vt(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function yt(e,t){for(var n=[],r=ht(ht({},function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:ct.Z;return e.labels.filter((function(e){return t.includes(e)})).map((function(e){return(0,a.Z)({},e,0)})).reduce((function(e,t){return ht(ht({},e),t)}),{})}(e)),t||{}),o=e.labels.map((function(t,n){return{name:t,size:e.shape[n]}})).find((function(e){return!ct.Z.includes(e.name)&&e.size})),i=0;i<Math.min(4,o.size);i+=1)n.push(ht((0,a.Z)({},o.name,i),r));return P(e.shape)?[ht(ht({},n[0]),{},{c:0})]:n}function mt(e){return gt.apply(this,arguments)}function gt(){return(gt=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c,s;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=Array.isArray(n)?n[n.length-1]:n,e.next=4,o.getRaster({selection:r});case 4:return i=e.sent,a=(0,u.mx)(i.data),c=a.domain,s=a.contrastLimits,e.abrupt("return",{domain:c,contrastLimits:s});case 8:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function bt(e){return Ot.apply(this,arguments)}function Ot(){return(Ot=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c,s,l,f,p,d,v;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=n[n.length-1],i=o.shape,a=o.labels,c=i[a.indexOf("z")]>>n.length-1,e.next=6,o.getRaster({selection:ht(ht({},r),{},{z:0})});case 6:return s=e.sent,e.next=9,o.getRaster({selection:ht(ht({},r),{},{z:Math.floor(c/2)})});case 9:return l=e.sent,e.next=12,o.getRaster({selection:ht(ht({},r),{},{z:Math.max(0,c-1)})});case 12:return f=e.sent,p=(0,u.mx)(s.data),d=(0,u.mx)(l.data),v=(0,u.mx)(f.data),e.abrupt("return",{domain:[Math.min(p.domain[0],d.domain[0],v.domain[0]),Math.max(p.domain[1],d.domain[1],v.domain[1])],contrastLimits:[Math.min(p.contrastLimits[0],d.contrastLimits[0],v.contrastLimits[0]),Math.max(p.contrastLimits[1],d.contrastLimits[1],v.contrastLimits[1])]});case 17:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function wt(e){return jt.apply(this,arguments)}function jt(){return(jt=(0,g.Z)(O().mark((function e(t){var n,r,o,i;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selection,o=t.use3d,i=o?bt:mt,e.abrupt("return",i({loader:n,selection:r}));case 3:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Ct(e){return Pt.apply(this,arguments)}function Pt(){return(Pt=(0,g.Z)(O().mark((function e(t){var n,r,o,i,a,c;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return n=t.loader,r=t.selections,o=t.use3d,e.next=3,Promise.all(r.map((function(e){return wt({loader:n,selection:e,use3d:o})})));case 3:return i=e.sent,a=i.map((function(e){return e.domain})),c=i.map((function(e){return e.contrastLimits})),e.abrupt("return",{domains:a,contrastLimits:c});case 7:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function kt(e){var t=Array.isArray(e)?e[0]:e,n=t.shape,r=t.labels,o=function(e){var t,n,r=null!==(t=null==e||null===(n=e.meta)||void 0===n?void 0:n.physicalSizes)&&void 0!==t?t:{},o=r.x,i=r.y,a=r.z;if(null!=o&&o.size&&null!=i&&i.size&&null!=a&&a.size){var c=Math.min(a.size,o.size,i.size),s=[o.size/c,i.size/c,a.size/c];return(new dt.Z).scale(s)}return(new dt.Z).identity()}(t);return[[0,o[0]*n[r.indexOf("x")]],[0,o[5]*n[r.indexOf("y")]],[0,o[10]*n[r.indexOf("z")]]]}function Zt(e){var t=e.Pixels||{},n=t.Channels,r=void 0===n?[]:n,o=t.SizeC,i=void 0===o?0:o,a=t.Interleaved,c=void 0!==a&&a,s=t.Type,l=r.length,u=(r[0]||{}).SamplesPerPixel;return 3===(void 0===u?0:u)||3===l&&"uint8"===s||3===i&&1===l&&c}var St=[0,255];function At(e,t){return e.Name||e.name||e.ID||"Channel ".concat(t+1)}function xt(e,t,n,r){return Et.apply(this,arguments)}function Et(){return(Et=(0,g.Z)(O().mark((function e(t,n,r,o){var i,a,s,l,u,f,p,d,v,h,y,m,g,b,w,j,C,k,Z,S,A,x,E,D;return O().wrap((function(e){for(;;)switch(e.prev=e.next){case 0:if(i=t[0]||{},a=i.shape,s=i.labels,l=(void 0===s?[]:s).map((function(e,t){return{label:e,size:a[t]||0}})).filter((function(e){return e.size>1&&ct.Z.includes(e.label)})),u=r||yt(t[0],o),f=n.Pixels,p=(void 0===f?{}:f).Channels,d=void 0===p?[]:p,v=[],h=[],y=[],m=!1,g=!1,b=Zt(n),w=b&&P(a),j=d.map(At),!b){e.next=19;break}P(a)?(v=[St.slice()],y=[St.slice()],h=[Ye.Q6]):(v=[St.slice(),St.slice(),St.slice()],y=[St.slice(),St.slice(),St.slice()],h=[Ye.Q6,Ye.ek,Ye.iN]),m=!1,g=!1,e.next=28;break;case 19:return e.next=21,Ct({loader:t,selections:u,use3d:!1});case 21:for(C=e.sent,y=C.domains.slice(),v=C.contrastLimits.slice(),h=[],k=0;k<j.length;k+=1)(Z=Ye.bA.getColorForChannel(j[k]))?h.push(Z):1===j.length?h.push(Ye.ix):h.push(Ye.ZP[h.length%Ye.ZP.length]);m=d.length>1,g=!0;case 28:return S=kt(t),A=(0,c.Z)(S,3),x=A[0],E=A[1],D=A[2],e.abrupt("return",{channels:j,selections:u,useLens:m,useColorMap:g,colors:h,domains:y,contrastLimits:v,xSlice:x,ySlice:E,zSlice:D,ready:!0,isRGB:b,shapeIsInterleaved:w,globalDimensions:l,metadata:n,loader:t});case 30:case"end":return e.stop()}}),e)})))).apply(this,arguments)}function Dt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Rt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Dt(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Dt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function Lt(e,t,n){var r=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{},i=r.selections,a=r.cache,c=r.imageTimePosition,s=void 0===c?0:c,l=r.imageZPosition,u=void 0===l?0:l,f=(0,o.useRef)(0);(0,o.useEffect)((function(){var r=e&&t&&e.Pixels&&t.length;if(r&&(i&&i!==a||!i)){n({type:Fe}),f.current+=1;var o=f.current;xt(t,e,i,s||u?{t:s,z:u}:void 0).then((function(e){o===f.current&&n(Rt({type:He},e))})).catch((function(e){console.warn("HCS Image Viewer error: ".concat(e.message)),console.error(e),n({type:We,error:e.message})}))}else r||n({type:He})}),[e,t,s,u,i,a,f,n])}function Mt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function It(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Mt(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Mt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}function zt(){return{}}function Bt(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:0,r=Array.isArray(e)?e[0]:e,o=k(r);if(o&&t){var i=o.width,a=o.height;return Math.log2(Math.min(t.width/i,t.height/a))-n}return-1/0}function Tt(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter((function(t){return Object.getOwnPropertyDescriptor(e,t).enumerable}))),n.push.apply(n,r)}return n}function Vt(e){for(var t=1;t<arguments.length;t++){var n=null!=arguments[t]?arguments[t]:{};t%2?Tt(Object(n),!0).forEach((function(t){(0,a.Z)(e,t,n[t])})):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):Tt(Object(n)).forEach((function(t){Object.defineProperty(e,t,Object.getOwnPropertyDescriptor(n,t))}))}return e}var Nt=new u.$h,Ht=new u.z6,Ft={glOptions:{preserveDrawingBuffer:!0}},Ut=[Nt],Wt=[Ht];function $t(e){var t=e.className,n=e.onStateChange,r=e.onRegisterStateActions,i=e.onViewerStateChanged,a=e.onProjectionChanged,s=e.style,l=e.minZoomBackOff,f=void 0===l?0:l,p=e.maxZoomBackOff,d=void 0===p?void 0:p,v=e.defaultZoomBackOff,h=void 0===v?0:v,y=e.overview,m=e.onCellClick,g=e.onEditAnnotation,b=function(){var e=(0,o.useReducer)(Ve,{},zt),t=(0,c.Z)(e,2),n=t[0],r=t[1];!function(e,t){var n=e||{},r=n.url,i=n.offsetsUrl;n.source,(0,o.useEffect)((function(){r&&(t({type:Pe}),(0,Ne.C)({url:r,offsetsUrl:i}).then((function(e){return t({type:ke,source:e})})).catch((function(e){return t({type:Ze,error:e.message})})))}),[r,i,t])}(n,r);var i=function(e){var t=(0,o.useReducer)(pt,{},Xe),n=(0,c.Z)(t,2),r=n[0],i=n[1],a=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.metadata,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),s=function(e){var t=e.imageIndex,n=void 0===t?0:t,r=e.loader,o=void 0===r?[]:r;if(!(n<0||n>=o.length))return o[n]}(e),l=e.imageTimePosition,u=void 0===l?0:l,f=e.imageZPosition,p=void 0===f?0:f,d=r.metadata,v=r.loader,h=r.selections,y=r.builtForSelections;return Lt(a,s,i,(0,o.useMemo)((function(){return{imageTimePosition:u,imageZPosition:p}}),[u,p])),Lt(d,v,i,(0,o.useMemo)((function(){return{selections:h,cache:y}}),[h,y])),{state:r,dispatch:i}}(n),a=i.state,s=i.dispatch,l=(0,o.useCallback)((function(e,t,n){r({url:e,offsetsUrl:t,callback:n,type:Ce})}),[r]),u=(0,o.useCallback)((function(e){r(It({type:Se},e))}),[r]),f=(0,o.useCallback)((function(e){r({type:xe,mesh:e})}),[r]),p=(0,o.useCallback)((function(){r({type:Ee,overlayImages:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]})}),[r]),d=(0,o.useCallback)((function(){r({type:De,annotations:arguments.length>0&&void 0!==arguments[0]?arguments[0]:[]})}),[r]),v=(0,o.useCallback)((function(e){r({type:Re,selectedAnnotation:e})}),[r]),h=(0,o.useCallback)((function(e){r(It({type:Ae},e)),s({type:Ue})}),[r,s]),y=(0,o.useCallback)((function(){s({type:Fe})}),[s]),m=(0,o.useCallback)((function(e,t){s({type:$e,channel:e,properties:t})}),[s]),g=(0,o.useCallback)((function(){s({type:Ge,defaultColors:arguments.length>0&&void 0!==arguments[0]?arguments[0]:{}})}),[s]),b=(0,o.useCallback)((function(e){s({type:_e,colorMap:e})}),[s]),O=(0,o.useCallback)((function(e){s({type:Ke,lensEnabled:e})}),[s]),w=(0,o.useCallback)((function(e){s({type:qe,lensChannel:e})}),[s]),j=(0,o.useCallback)((function(e){s({type:Qe,position:e})}),[s]),C=(0,o.useCallback)((function(e){s({type:Je,lock:e})}),[s]);return{callbacks:(0,o.useMemo)((function(){return{setData:l,setImage:u,setImageViewportLoading:y,setImageViewportLoaded:h,setChannelProperties:m,setDefaultChannelsColors:g,setColorMap:b,setLensEnabled:O,setLensChannel:w,setGlobalPosition:j,setLockChannels:C,setMesh:f,setOverlayImages:p,setAnnotations:d,setSelectedAnnotation:v}}),[l,u,y,h,m,g,b,O,w,j,C,f,p,d,v]),dispatch:r,state:n,viewerState:a,viewerDispatch:s}}(),O=b.state,w=b.viewerState,j=b.callbacks,C=O.mesh,P=O.overlayImages,k=O.annotations,Z=O.selectedAnnotation,S=O.pending,A=(0,o.useRef)(),x=function(e){var t=(0,o.useState)({width:void 0,height:void 0}),n=(0,c.Z)(t,2),r=n[0],i=n[1];return(0,o.useEffect)((function(){var t,n,r;return function o(){var a,c,s=null==e||null===(a=e.current)||void 0===a?void 0:a.clientWidth,l=null==e||null===(c=e.current)||void 0===c?void 0:c.clientHeight;e&&e.current&&(s!==t||l!==n)&&i({width:t=s,height:n=l}),r=requestAnimationFrame(o)}(),function(){return cancelAnimationFrame(r)}}),[e,i]),r}(A),E=j.setSelectedAnnotation,D=(0,o.useCallback)((function(e){Z!==e&&E(e)}),[Z,E]),R=(0,o.useState)(void 0),L=(0,c.Z)(R,2),M=L[0],I=L[1],z=(0,o.useCallback)((function(e){var t=(e||{}).viewState;if(t){var n=t.width,r=t.height,o=t.zoom,i=t.target,a=Math.pow(2,o);I({scale:a,width:n,height:r,position:i})}}),[I]);(0,o.useEffect)((function(){n&&n(O)}),[O,n]),(0,o.useEffect)((function(){i&&i(w)}),[w,i]),(0,o.useEffect)((function(){if(a){var e=M||{},t=e.width,n=void 0===t?0:t,r=e.height,o=void 0===r?0:r,i=e.scale,c=void 0===i?1:i,s=e.position,l=void 0===s?[0,0]:s;a((function(e){var t=[e[0]-n/2,e[1]-o/2];return[l[0]+t[0]/c,l[1]+t[1]/c]}))}}),[M,a]),(0,o.useEffect)((function(){r&&r(j)}),[j,r]);var B=j||{},T=B.setImageViewportLoading,V=B.setImageViewportLoaded,N=w.channelsVisibility,H=void 0===N?[]:N,F=w.contrastLimits,U=void 0===F?[]:F,W=w.colors,$=void 0===W?[]:W,G=w.selections,_=void 0===G?[]:G,q=w.ready,K=void 0!==q&&q,Q=w.colorMap,J=w.loader,X=w.useLens,Y=w.lensEnabled,ee=w.lensChannel,te=w.pending;(0,o.useEffect)((function(){"function"==typeof T&&T()}),[_,J,T]);var ne=(0,o.useState)(void 0),re=(0,c.Z)(ne,2),oe=re[0],ie=re[1];(0,o.useEffect)((function(){if(J&&J.length&&x.width&&x.height){var e=Array.isArray(J)?J:[J],t=(0,c.Z)(e,1)[0],n=Array.isArray(J)?J[J.length-1]:J,r=Vt(Vt({},(0,u.TI)(J,x,h)),{},{id:u.ys,minZoom:void 0!==f?Bt(t,x,f):-1/0,maxZoom:void 0!==d?Bt(n,x,d):1/0});ie([r]),z({viewState:Vt({width:x.width,height:x.height},r)})}else ie(void 0),z({})}),[J,x,ie,f,d,h,z]);var ae=J&&K&&x.width&&x.height&&oe;return o.createElement("div",{className:t,style:Vt({position:"relative"},s||{}),ref:A},ae&&o.createElement(je,{mesh:S||te?void 0:C,overlayImages:P,annotations:k,selectedAnnotation:Z,onSelectAnnotation:D,contrastLimits:U,colors:$,channelsVisible:H,loader:J,selections:_,height:x.height,width:x.width,extensions:Q?Ut:Wt,colormap:Q||"viridis",onViewportLoad:V,viewStates:oe,overviewOn:!!y,overview:y,lensSelection:X&&Y?ee:void 0,lensEnabled:X&&Y,onCellClick:m,onEditAnnotation:g,onViewStateChange:z,deckProps:Ft}))}$t.propTypes={className:l().string,onStateChange:l().func,onRegisterStateActions:l().func,onViewerStateChanged:l().func,onProjectionChanged:l().func,style:l().object,minZoomBackOff:l().number,maxZoomBackOff:l().number,defaultZoomBackOff:l().number,overview:l().object,onCellClick:l().func,onEditAnnotation:l().func},$t.defaultProps={className:void 0,onStateChange:void 0,onRegisterStateActions:void 0,onViewerStateChanged:void 0,onProjectionChanged:void 0,style:void 0,minZoomBackOff:0,maxZoomBackOff:void 0,defaultZoomBackOff:0,overview:void 0,onCellClick:void 0,onEditAnnotation:void 0};var Gt=$t;function _t(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=n.onStateChange,c=n.onRegisterStateActions,s=n.onViewerStateChanged,l=n.onProjectionChanged,u=n.onCellClick,f=n.onEditAnnotation;i.render(o.createElement(Gt,(0,r.Z)({onRegisterStateActions:c,onStateChange:a,onViewerStateChanged:s,onProjectionChanged:l,onCellClick:u,onEditAnnotation:f},t)),e)}}}]);