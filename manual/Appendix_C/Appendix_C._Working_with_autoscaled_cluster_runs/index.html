<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="en" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="en" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  
  <link rel="shortcut icon" href="../../../img/favicon.ico">
  <title>Appendix C. Working with autoscaled cluster runs - Cloud Pipeline</title>
  <link href='https://fonts.googleapis.com/css?family=Lato:400,700|Roboto+Slab:400,700|Inconsolata:400,700' rel='stylesheet' type='text/css'>

  <link rel="stylesheet" href="../../../css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../../css/theme_extra.css" type="text/css" />
  <link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/styles/github.min.css">
  <link href="../../../css/extra.css" rel="stylesheet">
  
  <script>
    // Current page data
    var mkdocs_page_name = "Appendix C. Working with autoscaled cluster runs";
    var mkdocs_page_input_path = "manual/Appendix_C/Appendix_C._Working_with_autoscaled_cluster_runs.md";
    var mkdocs_page_url = null;
  </script>
  
  <script src="../../../js/jquery-2.1.1.min.js" defer></script>
  <script src="../../../js/modernizr-2.8.3.min.js" defer></script>
  <script src="//cdnjs.cloudflare.com/ajax/libs/highlight.js/9.12.0/highlight.min.js"></script>
  <script>hljs.initHighlightingOnLoad();</script> 
  
</head>

<body class="wy-body-for-nav" role="document">

  <div class="wy-grid-for-nav">

    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side stickynav">
      <div class="wy-side-nav-search">
        <a href="../../.." class="icon icon-home"> Cloud Pipeline</a>
        <div role="search">
  <form id ="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" title="Type search term here" />
  </form>
</div>
      </div>

      <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
	<ul class="current">
	  
          
            <li class="toctree-l1">
		
    <a class="" href="../../..">Introduction</a>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Release notes</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../release_notes/v.0.13/v.0.13_-_Release_notes/">v.0.13</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../release_notes/v.0.14/v.0.14_-_Release_notes/">v.0.14</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../release_notes/v.0.15/v.0.15_-_Release_notes/">v.0.15</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../release_notes/v.0.16/v.0.16_-_Release_notes/">v.0.16</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">User guide</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../Cloud_Pipeline_-_Manual/">Contents</a>
                </li>
                <li class="">
                    
    <a class="" href="../../01_Quick_start/1._Quick_start/">1. Quick start</a>
                </li>
                <li class="">
                    
    <a class="" href="../../02_Getting_started/2._Getting_started/">2. Getting started</a>
                </li>
                <li class="">
                    
    <a class="" href="../../03_Overview/3._Overview/">3. Overview</a>
                </li>
                <li class="">
                    
    <span class="caption-text">4. Manage Folder</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4._Manage_Folder/">4.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4.1._Create_an_object_in_Folder/">4.1. Create an object in Folder</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4.2._Rename_folder/">4.2. Rename Folder</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4.3._Delete_Folder/">4.3. Delete Folder</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4.4._Clone_a_folder/">4.4. Clone a Folder</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../04_Manage_Folder/4.5._Lock_a_folder/">4.5. Lock a Folder</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">5. Manage Metadata</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5._Manage_Metadata/">5.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5.1._Add_Delete_metadata_items/">5.1. Add/delete Metadata items</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5.2._Upload_metadata/">5.2. Upload Metadata</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5.3._Customize_view_of_the_entity_instance_table/">5.3. Customize view of the entity instance table</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5.4._Launch_a_run_configuration_on_metadata/">5.4. Launch a Run configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../05_Manage_Metadata/5.5._Download_data_from_external_resources_to_the_cloud_data_storage/">5.5. Download data from external resources</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">6. Manage Pipeline</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../06_Manage_Pipeline/6._Manage_Pipeline/">6.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../06_Manage_Pipeline/6.1._Create_and_configure_pipeline/">6.1. Create and configure Pipeline</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../06_Manage_Pipeline/6.1.1._Building_WDL_pipeline_with_graphical_PipelineBuilder/">6.1.1. Building WDL Pipeline with graphical PipelineBuilder</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../06_Manage_Pipeline/6.2._Launch_a_pipeline/">6.2. Launch a Pipeline</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../06_Manage_Pipeline/6.3._Delete_a_pipeline/">6.3. Delete and unregister Pipeline</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">7. Manage Detached configuration</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../07_Manage_Detached_configuration/7._Manage_Detached_configuration/">7.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../07_Manage_Detached_configuration/7.1._Create_and_customize_Detached_configuration/">7.1. Create and customize Detached configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../07_Manage_Detached_configuration/7.2._Launch_Detached_Configuration/">7.2. Launch Detached configuration</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../07_Manage_Detached_configuration/7.3._Expansion_Expressions/">7.3. Expansion expressions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../07_Manage_Detached_configuration/7.4._Remove_Detached_configuration/">7.4. Remove Detached configuration</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">8. Manage Data Storage</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8._Manage_Data_Storage/">8.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.1._Create_and_edit_storage/">8.1. Create and edit Data Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.2._Upload_Download_data/">8.2. Upload/Download data</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.3._Create_and_Edit_text_files/">8.3. Create and edit text files</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.4._Control_File_versions/">8.4. Control file versions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.5._Delete_and_unregister_Data_Storage/">8.5. Delete and unregister Data Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.6._Delete_Files_and_Folders_from_Storage/">8.6. Delete Files and Folders from Data Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.7._Create_shared_file_system/">8.7. Create shared file system</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../08_Manage_Data_Storage/8.8._Data_sharing/">8.8. Data sharing</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../09_Manage_Cluster_nodes/9._Manage_Cluster_nodes/">9. Manage cluster nodes</a>
                </li>
                <li class="">
                    
    <span class="caption-text">10. Manage Tools</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10._Manage_Tools/">10.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.1._Add_Edit_a_Docker_registry/">10.1. Add and edit a Docker registry</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.2._Add_Edit_a_Tool_group/">10.2. Add/edit a Tool group</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.3._Add_a_Tool/">10.3. Add a Tool</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.4._Edit_a_Tool/">10.4. Edit a Tool</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.5._Launch_a_Tool/">10.5. Launch a Tool</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.6._Tool_security_check/">10.6. Tool security check</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.7._Tool_version_menu/">10.7. Tool version menu</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../10_Manage_Tools/10.8._Symlinks_between_tools/">10.8. "Symlinked" tools</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">11. Manage Runs</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../11_Manage_Runs/11._Manage_Runs/">11.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../11_Manage_Runs/11.1._Manage_runs_lifecycles/">11.1. Manage runs lifecycles</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../11_Manage_Runs/11.2._Auto-commit_Docker_image/">11.2. Auto-commit Docker images</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../11_Manage_Runs/11.3._Sharing_with_other_users_or_groups_of_users/">11.3. Sharing with other users</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../11_Manage_Runs/11.4._Automatic_actions_after_notifications/">11.4. Automatic labels and actions for the runs</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">12. Manage settings</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12._Manage_Settings/">12.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.1._Add_a_new_system_event/">12.1. Add a new system event</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.2._Edit_a_system_event/">12.2. Edit a system event</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.3._Create_a_new_user/">12.3. Create a new user</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.4._Edit_delete_a_user/">12.4. Edit/delete a user</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.5._Create_a_group/">12.5. Create a group</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.6._Edit_a_group_role/">12.6. Edit a group/role</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.7._Delete_a_group/">12.7. Delete a group</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.8._Change_a_set_of_roles_groups_for_a_user/">12.8. Change a set of roles/groups for a user</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.9._Change_email_notification/">12.9. Change email notification</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.10._Manage_system-level_settings/">12.10. Manage system-level settings</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.11._Advanced_features/">12.11. Advanced features</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../12_Manage_Settings/12.12._System_logs/">12.12. System logs</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../13_Permissions/13._Permissions/">13. Permissions</a>
                </li>
                <li class="">
                    
    <span class="caption-text">14. CLI interface</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14._Command-line_interface/">14.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.1._Install_and_setup_CLI/">14.1. Install and setup</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.2._View_and_manage_Attributes_via_CLI/">14.2. View and manage Attributes</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.3._Manage_Storage_via_CLI/">14.3. Manage Data Storage</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.4._View_pipeline_definitions_via_CLI/">14.4. View pipeline definitions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.5._Manage_pipeline_executions_via_CLI/">14.5. Manage pipeline executions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.6._View_cluster_nodes_via_CLI/">14.6. View cluster nodes</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.7._View_and_manage_Permissions_via_CLI/">14.7. View and manage Permissions</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../14_CLI/14.8._View_tools_definitions_via_CLI/">14.8. View tools definitions</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <span class="caption-text">15. Interactive services</span>
    <ul class="subnav">
                <li class="toctree-l3">
                    
    <a class="" href="../../15_Interactive_services/15._Interactive_services/">15.0. Overview</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../15_Interactive_services/15.1._Starting_an_Interactive_application/">15.1. Starting an interactive application</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../15_Interactive_services/15.2._Using_Terminal_access/">15.2. Using terminal access</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../15_Interactive_services/15.3._Expose_node_filesystem/">15.3. Expose node filesystem</a>
                </li>
                <li class="toctree-l3">
                    
    <a class="" href="../../15_Interactive_services/15.4._Interactive_service_examples/">15.4. Interactive service examples</a>
                </li>
    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../16_Issues/16._Issues/">16. Issues</a>
                </li>
                <li class="">
                    
    <a class="" href="../../17_Tagging_by_attributes/17._CP_objects_tagging_by_additional_attributes/">17. CP objects tagging by additional attributes</a>
                </li>
                <li class="">
                    
    <a class="" href="../../18_Home_page/18._Home_page/">18. Home page</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Appendix_A/Appendix_A._Instance_and_Docker_container_lifecycles/">Appendix A. Instance and Docker container lifecycles</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Appendix_B/Appendix_B._Working_with_a_Project/">Appendix B. Working with a Project</a>
                </li>
                <li class=" current">
                    
    <a class="current" href="./">Appendix C. Working with autoscaled cluster runs</a>
    <ul class="subnav">
            
    <li class="toctree-l3"><a href="#working-with-autoscaled-cluster-runs">Working with autoscaled cluster runs</a></li>
    
        <ul>
        
            <li><a class="toctree-l4" href="#overview">Overview</a></li>
        
            <li><a class="toctree-l4" href="#limitations">Limitations</a></li>
        
            <li><a class="toctree-l4" href="#how-it-works">How it works</a></li>
        
            <li><a class="toctree-l4" href="#configurations">Configurations</a></li>
        
            <li><a class="toctree-l4" href="#examples">Examples</a></li>
        
        </ul>
    

    </ul>
                </li>
                <li class="">
                    
    <a class="" href="../../Appendix_D/Appendix_D._Costs_management/">Appendix D. Costs management</a>
                </li>
                <li class="">
                    
    <a class="" href="../../Appendix_E/Appendix_E._Pipeline_objects_concept/">Appendix E. Pipeline objects concept</a>
                </li>
    </ul>
	    </li>
          
            <li class="toctree-l1">
		
    <span class="caption-text">Cloud Pipeline API</span>
    <ul class="subnav">
                <li class="">
                    
    <a class="" href="../../../api/API_tutorials/API_tutorials/">API tutorials</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../api/API_tutorials/Automation_via_CLI/">Automation via CLI</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../api/API_tutorials/Direct_HTTP_API/">Direct HTTP API implementation</a>
                </li>
                <li class="">
                    
    <a class="" href="../../../api/API_tutorials/JavaScript_example/">JavaScript example</a>
                </li>
    </ul>
	    </li>
          
        </ul>
      </div>
      &nbsp;
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" role="navigation" aria-label="top navigation">
        <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
        <a href="../../..">Cloud Pipeline</a>
      </nav>

      
      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="breadcrumbs navigation">
  <ul class="wy-breadcrumbs">
    <li><a href="../../..">Docs</a> &raquo;</li>
    
      
        
          <li>User guide &raquo;</li>
        
      
    
    <li>Appendix C. Working with autoscaled cluster runs</li>
    <li class="wy-breadcrumbs-aside">
      
    </li>
  </ul>
  <hr/>
</div>
          <div role="main">
            <div class="section">
              
                <h1 id="working-with-autoscaled-cluster-runs">Working with autoscaled cluster runs</h1>
<ul>
<li><a href="#overview">Overview</a></li>
<li><a href="#limitations">Limitations</a></li>
<li><a href="#how-it-works">How it works</a><ul>
<li><a href="#finding-expired-jobs">Finding expired jobs</a></li>
<li><a href="#launching-workers">Launching workers</a></li>
<li><a href="#determing-worker-instance-types">Determing worker instance types</a></li>
<li><a href="#killing-excessive-workers">Killing excessive workers</a></li>
<li><a href="#preventing-deadlocks">Preventing deadlocks</a></li>
</ul>
</li>
<li><a href="#configurations">Configurations</a></li>
<li><a href="#examples">Examples</a><ul>
<li><a href="#homogeneous-cluster">Homogeneous cluster</a></li>
<li><a href="#hybrid-cluster">Hybrid cluster</a></li>
</ul>
</li>
</ul>
<h2 id="overview">Overview</h2>
<p>Cloud Pipeline has support for launching runs using a single machine or a cluster of machines.<br />
Moreover Cloud Pipeline allows to launch so-called <em>autoscaled clusters</em> which are basically clusters of machines with dynamic size.<br />
It means that during the run execution additional worker machines can be attached to the cluster as well as removed from it.<br />
By the way an autoscaled cluster can have so-called <em>persistent</em> workers which cannot be affected by the autoscaler.</p>
<h2 id="limitations">Limitations</h2>
<p>Currently only the SGE-based runs can be used efficiently with an autoscaled cluster capability.<br />
And only the CPU requirements of the SGE jobs are considered while calculating cluster unsatisfied resources.</p>
<h2 id="how-it-works">How it works</h2>
<p>The cluster autoscaling tries to be intuitive and is pretty straightforward in most cases.<br />
Nevertheless it can get cumbersome with all the allowed customization parameters.</p>
<p>The overall autoscaling approach is briefly described below.<br />
Please notice that all the described steps are executed repeatedly for all the cluster lifetime depending on the current situation.  </p>
<h3 id="finding-expired-jobs">Finding expired jobs</h3>
<p>Autoscaler is a background process which constantly watches the SGE queues in order to find <em>expired jobs</em>.<br />
Basically expired jobs are the jobs that wait in any queue for more than some predefined time.</p>
<h3 id="launching-workers">Launching workers</h3>
<p>Once expired jobs are found the autoscaler tries to launch an additional worker.<br />
The only case additional worker won't be launched is if all allowed additional workers are already set up.</p>
<h3 id="determing-worker-instance-types">Determing worker instance types</h3>
<p>Additional worker instance types can vary from only a master instance type up to some instance types family.<br />
Therefore there are <em>homogeneous clusters</em> that launches only the master instance type machines and <em>hybrid clusters</em> which
launches instance types from some instance type family.<br />
By default all autoscaled clusters are homogeneous.</p>
<p>If an autoscaled cluster is hybrid and it is launching an additional worker then its instance type will be resolved based on the amount of unsatisfied CPU requirements of all pending jobs.
The autoscaler will try to launch the smallest allowed instance from a specific instance type family that can process all the pending jobs simultaneously.
For instance if there are two pending jobs with the CPU requirements of 4 and 8 then the autoscaler will try to launch the instance which has at least 12 CPUs.</p>
<h3 id="killing-excessive-workers">Killing excessive workers</h3>
<p>Once required additional workers are set up the cluster gets bigger and more jobs can be executed simultaneously.<br />
At some point while jobs finish their execution some additional workers may become excessive.<br />
In this case the autoscaler will check if all the queues were empty for at least some predefined time and try to remove excessive additional workers from the cluster.</p>
<h3 id="preventing-deadlocks">Preventing deadlocks</h3>
<p>In some specific cases autoscaled clusters may enter the <em>deadlock</em> situation.<br />
In terms of autoscaled clusters a deadlock is a situation when submitted jobs cannot be executed in the best allowed cluster configuration.</p>
<p>For example if a hybrid autoscaled cluster which can have at most a machine with 64 CPUs is used to submit a job with a requirement of 100 CPUs then the job won't be ever executed and will stuck in queue forever. Fortunately the autoscaler can detect such deadlocks and prevent them simply killing jobs that cannot be executed anyway.<br />
It most likely will fail the run execution but it is reasonable since the cluster usage is not properly configured in the run.</p>
<p>Besides an actual deadlock situation where are some similar cases when the cluster has reached its full capacity but some of the jobs are still pending.<br />
It is not the deadlock situation since the jobs can be still executed but in the different cluster configuration.<br />
The autoscaler will detect such situations and replace weak addition workers with a better ones.</p>
<h2 id="configurations">Configurations</h2>
<table>
<thead>
<tr>
<th>System parameter</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>CP_CAP_AUTOSCALE_HYBRID</code></td>
<td>Enables hybrid cluster mode. It means that additional worker type can vary within either master instance type family or <code>CP_CAP_AUTOSCALE_HYBRID_FAMILY</code> if specified.</td>
</tr>
<tr>
<td><code>CP_CAP_AUTOSCALE_HYBRID_FAMILY</code></td>
<td>Hybrid cluster additional worker instance type family. For example <code>c5</code> or <code>r5</code> instance families can be used for AWS.</td>
</tr>
<tr>
<td><code>CP_CAP_AUTOSCALE_HYBRID_MAX_CORE_PER_NODE</code></td>
<td>The maximum number of cores that hybrid cluster additional worker instances can have.</td>
</tr>
<tr>
<td><code>CP_CAP_AUTOSCALE_VERBOSE</code></td>
<td>Enables verbose logging.</td>
</tr>
<tr>
<td><code>CP_CAP_AUTOSCALE_PRICE_TYPE</code></td>
<td>Cluster additional worker instance price type. Defaults to master instance price type.</td>
</tr>
<tr>
<td><code>CP_CAP_SGE_MASTER_CORES</code></td>
<td>The number of cores that master run can use for job submissions. If set to 0 then no jobs will be executed on the master. Defaults to all the master instance cores.</td>
</tr>
<tr>
<td><code>CP_CAP_SGE_WORKER_FREE_CORES</code></td>
<td>The number of cores that all worker and master runs have to reserve from job submissions. Defaults to 0 which means that all instance cores will be used for job submissions.</td>
</tr>
</tbody>
</table>
<h2 id="examples">Examples</h2>
<h3 id="homogeneous-cluster">Homogeneous cluster</h3>
<p>In this example we will see how an autoscaled cluster behaves on different conditions.</p>
<ol>
<li>Let's say we have launch an autoscaled cluster of <code>m5.large</code> instances (2 CPUs per instance) with no persistent workers which can scale up to 2 workers.<br />
You can find information on how to do that <a href="../../06_Manage_Pipeline/6._Manage_Pipeline/#configuration">in the corresponding page</a>.</li>
<li>On the <strong>Runs</strong> page we can see that the launched run doesn't have any workers.<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_1.PNG" /></li>
<li>On the <strong>Run logs page</strong> click the <strong>SSH</strong> button when it will become available.</li>
<li>In the opened terminal submit 10 single-core jobs to SGE queue using the following command <code>qsub -b y -t 1:10 sleep 10m</code>.</li>
<li>Check that the jobs have been successfully submitted using <code>qstat</code> command:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_2.PNG" /></li>
<li>Within several minutes an additional worker will be automatically added to out cluster:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_3.PNG" /></li>
<li>Once the additional worker is fully initialized we can see that it takes several jobs from the queue:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_4.PNG" /></li>
<li>A few moments later if there are still pending jobs in the queue a second additional worker will be created:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_5.PNG" /></li>
<li>And once it is initialized the worker will grab remaining jobs from the queue as well:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_6.PNG" /></li>
<li>As long as the most of the jobs are finishing and the workers become excessive they will be removed from the cluster:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_7.PNG" /></li>
<li>At first one of the workers becomes stopped:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_8.PNG" /></li>
<li>And then the last one becomes stopped too:<br />
<img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_9.PNG" /></li>
<li>From this point the cluster can scale up and down again and again depending on the workload.</li>
</ol>
<h3 id="hybrid-cluster">Hybrid cluster</h3>
<p>In this example we will see how a hybrid cluster behaves on different workloads.</p>
<ol>
<li>To start a hybrid cluster you have to configure a regular autoscaling cluster as described <a href="../../06_Manage_Pipeline/6._Manage_Pipeline/#configuration">here</a>.
Only the additional system parameter <code>CP_CAP_AUTOSCALE_HYBRID</code> have to be specified.
Open the <strong>Advanced</strong> tab on the <strong>launch page</strong> and click <strong>Add system parameter</strong> button.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_10.PNG" /></li>
<li>Then type down <em>HYBRID</em> into the search field of the opened popup and select <em>CP_CAP_AUTOSCALE_HYBRID</em> system parameter. 
Once the parameter is selected click <strong>OK (1)</strong> button.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_11.PNG" /></li>
<li>Configure an autoscaled cluster with the same configuration as in the example above and launch the run.</li>
<li>On the <strong>Runs</strong> page click on the launched run.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_12.PNG" /></li>
<li>Wait for the <strong>SSH</strong> button to appear and click on it.</li>
<li>In the opened terminal submit 10 single-core jobs to SGE queue using the following command <code>qsub -b y -t 1:10 sleep 10m</code>.</li>
<li>Check that the jobs have been successfully submitted using <code>qstat</code> command:
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_13.PNG" /></li>
<li>If you go back to the <strong>run page</strong> and wait for a few minutes then you will see that an additional worker is launched. 
Click on the additional worker run link to find out what instance type it uses.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_14.PNG" /></li>
<li>The additional worker instance type in this case is <em>m5.2xlarge</em> which has 8 CPUs and 32GB of RAM.
Please notice that the instance type selecting mechanism is highly situational and the resulting instance type can be different between launches.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_15.PNG" /></li>
<li>Once the additional worker is initialized it will grab all the remaining jobs from the queue.
    <img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_16.PNG" /></li>
<li>And after about 10 minutes an additional worker will be scaled down since there are no pending jobs anymore.
    <br/><img alt="CP_AppendixC" src="../attachments/WorkWithAutoscaledCluster_17.PNG" /></li>
<li>From this point the cluster can scale up and down again and again depending on the workload.</li>
</ol>
              
            </div>
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="../../Appendix_D/Appendix_D._Costs_management/" class="btn btn-neutral float-right" title="Appendix D. Costs management">Next <span class="icon icon-circle-arrow-right"></span></a>
      
      
        <a href="../../Appendix_B/Appendix_B._Working_with_a_Project/" class="btn btn-neutral" title="Appendix B. Working with a Project"><span class="icon icon-circle-arrow-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <!-- Copyright etc -->
    
  </div>

  Built with <a href="http://www.mkdocs.org">MkDocs</a> using a <a href="https://github.com/snide/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>.
</footer>
      
        </div>
      </div>

    </section>

  </div>

  <div class="rst-versions" role="note" style="cursor: pointer">
    <span class="rst-current-version" data-toggle="rst-current-version">
      
      
        <span><a href="../../Appendix_B/Appendix_B._Working_with_a_Project/" style="color: #fcfcfc;">&laquo; Previous</a></span>
      
      
        <span style="margin-left: 15px"><a href="../../Appendix_D/Appendix_D._Costs_management/" style="color: #fcfcfc">Next &raquo;</a></span>
      
    </span>
</div>
    <script>var base_url = '../../..';</script>
    <script src="../../../js/theme.js" defer></script>
      <script src="../../../css/extra.js" defer></script>
      <script src="../../../search/main.js" defer></script>

</body>
</html>
